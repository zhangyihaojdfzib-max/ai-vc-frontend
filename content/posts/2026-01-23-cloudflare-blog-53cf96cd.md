---
title: Cloudflare路由泄漏事件回顾：配置错误导致25分钟服务中断
title_original: Route leak incident on January 22, 2026
date: '2026-01-23'
source: Cloudflare Blog
source_url: https://blog.cloudflare.com/route-leak-incident-january-22-2026/
author: ''
summary: 2026年1月22日，Cloudflare因自动化配置错误在迈阿密数据中心引发BGP路由泄漏，持续25分钟。该事件导致IPv6流量异常，部分骨干网络拥塞，客户流量丢包率上升。泄漏源于移除波哥大数据中心BGP通告的策略变更，意外将接收的路由重新分发给了对等体和提供商，违反了无谷路由规则。Cloudflare团队迅速回滚配置并暂停自动化程序，最终恢复服务。文章详细分析了事件经过、技术原因及响应流程。
categories:
- AI基础设施
tags:
- BGP路由泄漏
- 网络故障
- Cloudflare
- 自动化配置
- 网络运维
draft: false
translated_at: '2026-01-24T04:30:28.174068'
---

# 2026年1月22日路由泄漏事件

- Bryton Herdes
- Tom Strickx

![Bryton Herdes](/images/posts/edfba2eecaa3.jpg)

2026年1月22日，一次自动路由策略配置错误导致我们无意中从位于佛罗里达州迈阿密数据中心的某台路由器泄漏了一些边界网关协议（BGP）前缀。虽然此次路由泄漏对Cloudflare客户造成了一定影响，但由于他们的流量意外地流经了我们的迈阿密数据中心，多个外部方也受到了波及。

此次路由泄漏持续了25分钟，导致我们在迈阿密的部分骨干基础设施出现拥塞，部分Cloudflare客户流量丢包率升高，流经这些链路的流量延迟增加。此外，部分流量被我们路由器上的防火墙过滤器丢弃，这些过滤器设计为仅接收发往Cloudflare服务及我们客户的流量。

尽管我们此前曾多次撰文讨论路由泄漏，但我们自身很少引发此类事件。本次路由泄漏是Cloudflare网络中一台路由器意外配置错误的结果，并且仅影响了IPv6流量。我们真诚地向因此次BGP路由泄漏而受到影响的用户、客户及网络表示歉意。

我们曾多次撰文探讨BGP路由泄漏，甚至还在Cloudflare Radar上记录了路由泄漏事件，供任何人查看和学习。要更全面地理解路由泄漏，您可以参考此详细背景说明部分，或查阅RFC7908中的正式定义。

本质上，当某个网络告诉更广泛的互联网将本不应由其转发的流量发送给它时，就会发生路由泄漏。从技术上讲，当一个网络或自治系统（AS）意外地出现在AS路径中时，就会发生路由泄漏。AS路径是BGP用来确定穿越互联网到达最终目的地的路径。一个表明路由泄漏的异常AS路径示例是：发现某个网络将从对等体接收的路由发送给了提供商。

在此类路由泄漏期间，无谷路由规则被违反，因为BGP更新从AS64501发送给其同级对等体（AS64502），然后意外地上传到提供商（AS64503）。通常，泄漏者（本例中为AS64502）并未准备好处理其将接收的流量规模，甚至可能未配置防火墙过滤器来接受所有流向其方向的流量。简而言之，一旦路由更新发送给对等体或提供商，它应仅进一步发送给客户，而不应发送给另一个对等体或提供商AS。

在1月22日的事件中，我们引发了类似的路由泄漏，我们从部分对等体获取路由，并在迈阿密将这些路由重新分发给了我们的一些对等体和提供商。根据RFC7908中的路由泄漏定义，我们在互联网上引发了混合的3类和4类路由泄漏。

最终触发路由策略错误的变更被合并到我们的网络自动化代码仓库中

自动化程序在迈阿密单一边缘路由器上运行，导致向BGP传输提供商和对等体发送意外通告

网络团队开始调查来自迈阿密的意外路由通告

事件升级以协调响应

网络操作员手动回滚了错误的配置变更，并暂停了该路由器的自动化程序，使其无法再次运行

触发泄漏的变更从我们的代码仓库中回滚

操作员确认自动化程序在迈阿密路由器上可再次健康运行，且不再包含路由策略错误

迈阿密单一路由器上的自动化程序恢复运行

### 事件经过：配置错误

2026年1月22日UTC时间20:25，我们通过策略自动化平台推送了一项变更，旨在移除迈阿密对我们位于哥伦比亚波哥大的某个数据中心的BGP通告。这是有意为之，因为我们此前曾通过迈阿密将部分IPv6流量转发至波哥大数据中心，但近期的基础设施升级使我们无需再这样做。

此变更生成了以下差异（一种用于比较配置文件以确定其差异的程序）：

```
[edit policy-options policy-statement 6-COGENT-ACCEPT-EXPORT term ADV-SITELOCAL-GRE-RECEIVER from]
-      prefix-list 6-BOG04-SITE-LOCAL;
[edit policy-options policy-statement 6-COMCAST-ACCEPT-EXPORT term ADV-SITELOCAL-GRE-RECEIVER from]
-      prefix-list 6-BOG04-SITE-LOCAL;
[edit policy-options policy-statement 6-GTT-ACCEPT-EXPORT term ADV-SITELOCAL-GRE-RECEIVER from]
-      prefix-list 6-BOG04-SITE-LOCAL;
[edit policy-options policy-statement 6-LEVEL3-ACCEPT-EXPORT term ADV-SITELOCAL-GRE-RECEIVER from]
-      prefix-list 6-BOG04-SITE-LOCAL;
[edit policy-options policy-statement 6-PRIVATE-PEER-ANYCAST-OUT term ADV-SITELOCAL from]
-      prefix-list 6-BOG04-SITE-LOCAL;
[edit policy-options policy-statement 6-PUBLIC-PEER-ANYCAST-OUT term ADV-SITELOCAL from]
-      prefix-list 6-BOG04-SITE-LOCAL;
[edit policy-options policy-statement 6-PUBLIC-PEER-OUT term ADV-SITELOCAL from]
-      prefix-list 6-BOG04-SITE-LOCAL;
[edit policy-options policy-statement 6-TELEFONICA-ACCEPT-EXPORT term ADV-SITELOCAL-GRE-RECEIVER from]
-      prefix-list 6-BOG04-SITE-LOCAL;
[edit policy-options policy-statement 6-TELIA-ACCEPT-EXPORT term ADV-SITELOCAL-GRE-RECEIVER from]
-      prefix-list 6-BOG04-SITE-LOCAL;
```

虽然乍看之下此策略变更似乎无害，但仅移除包含BOG04单播前缀的前缀列表导致策略变得过于宽松：

```
policy-options policy-statement 6-TELIA-ACCEPT-EXPORT {
    term ADV-SITELOCAL-GRE-RECEIVER {
        from route-type internal;
        then {
            community add STATIC-ROUTE;
            community add SITE-LOCAL-ROUTE;
            community add MIA01;
            community add NORTH-AMERICA;
            accept;
        }
    }
}

```

现在，该策略会将所有类型为“internal”的前缀标记为可接受，并为所有匹配的前缀添加一些信息性团体属性。但更重要的是，该策略还通过策略过滤器接受了该路由，这导致本应为“internal”的前缀被对外通告。这是一个问题，因为在JunOS或JunOS EVO（HPE Juniper Networks设备使用的操作系统）中，“route-type internal”匹配项将匹配任何非外部路由类型，例如内部BGP（IBGP）路由，这正是此处发生的情况。

结果，Cloudflare在骨干网内部重新分发的所有IPv6前缀都被此策略接受，并通告给了我们在迈阿密的所有BGP邻居。不幸的是，这与我们在2020年经历的中断非常相似，您可以在我们的博客上阅读更多相关信息。

当策略错误配置在UTC时间20:25应用时，一系列意外的BGP更新从AS13335发送给了迈阿密的对等体和提供商。这些BGP更新可以通过使用monocle工具查看MRT文件或使用RIPE BGPlay进行历史查看。

```
â  ~ monocle search --start-ts 2026-01-22T20:24:00Z --end-ts 2026-01-22T20:30:00Z --as-path ".*13335[ \d$]32934$*"
A|1769113609.854028|2801:14:9000::6:4112:1|64112|2a03:2880:f077::/48|64112 22850 174 3356 13335 32934|IGP|2801:14:9000::6:4112:1|0|0|22850:65151|false|||pit.scl
A|1769113609.854028|2801:14:9000::6:4112:1|64112|2a03:2880:f091::/48|64112 22850 174 3356 13335 32934|IGP|2801:14:9000::6:4112:1|0|0|22850:65151|false|||pit.scl
A|1769113609.854028|2801:14:9000::6:4112:1|64112|2a03:2880:f16f::/48|64112 22850 174 3356 13335 32934|IGP|2801:14:9000::6:4112:1|0|0|22850:65151|false|||pit.scl
A|1769113609.854028|2801:14:9000::6:4112:1|64112|2a03:2880:f17c::/48|64112 22850 174 3356 13335 32934|IGP|2801:14:9000::6:4112:1|0|0|22850:65151|false|||pit.scl
A|1769113609.854028|2801:14:9000::6:4112:1|64112|2a03:2880:f26f::/48|64112 22850 174 3356 13335 32934|IGP|2801:14:9000::6:4112:1|0|0|22850:65151|false|||pit.scl
A|1769113609.854028|2801:14:9000::6:4112:1|64112|2a03:2880:f27c::/48|64112 22850 174 3356 13335 32934|IGP|2801:14:9000::6:4112:1|0|0|22850:65151|false|||pit.scl
A|1769113609.854028|2801:14:9000::6:4112:1|64112|2a03:2880:f33f::/48|64112 22850 174 3356 13335 32934|IGP|2801:14:9000::6:4112:1|0|0|22850:65151|false|||pit.scl
A|1769113583.095278|2001:504:d::4:9544:1|49544|2a03:2880:f17c::/48|49544 1299 3356 13335 32934|IGP|2001:504:d::4:9544:1|0|0|1299:25000 1299:25800 49544:16000 49544:16106|false|||route-views.isc
A|1769113583.095278|2001:504:d::4:9544:1|49544|2a03:2880:f27c::/48|49544 1299 3356 13335 32934|IGP|2001:504:d::4:9544:1|0|0|1299:25000 1299:25800 49544:16000 49544:16106|false|||route-views.isc
A|1769113583.095278|2001:504:d::4:9544:1|49544|2a03:2880:f091::/48|49544 1299 3356 13335 32934|IGP|2001:504:d::4:9544:1|0|0|1299:25000 1299:25800 49544:16000 49544:16106|false|||route-views.isc
A|1769113584.324483|2001:504:d::19:9524:1|199524|2a03:2880:f091::/48|199524 1299 3356 13335 32934|IGP|2001:2035:0:2bfd::1|0|0||false|||route-views.isc
A|1769113584.324483|2001:504:d::19:9524:1|199524|2a03:2880:f17c::/48|199524 1299 3356 13335 32934|IGP|2001:2035:0:2bfd::1|0|0||false|||route-views.isc
A|1769113584.324483|2001:504:d::19:9524:1|199524|2a03:2880:f27c::/48|199524 1299 3356 13335 32934|IGP|2001:2035:0:2bfd::1|0|0||false|||route-views.isc
{trimmed}
```

在上面看到的 monocle 输出中，我们有 BGP 更新的时间戳，接着是宣告中的下一跳、向特定路由收集器提供路由的网络的自治系统号、涉及的前缀，以及 AS 路径和 BGP 团体属性（如果存在）。在每行输出的末尾，我们还看到了路由收集器实例。

查看前缀 2a03:2880:f077::/48 的第一个更新，其 AS 路径是 `64112 22850 174 3356 13335 32934`。这意味着我们（AS13335）从对等方 Meta（AS32934）收到了该前缀，然后将其通告给了我们的上游传输提供商之一 Lumen（AS3356）。我们知道这是一次路由泄露，因为从对等方接收的路由只应被重新通告给下游（客户）网络，而不是横向通告给其他对等方或向上通告给提供商。

由于这次泄露以及来自提供商和对等方的非预期流量被转发到我们的迈阿密路由器，我们迈阿密和亚特兰大之间的骨干网出现了拥塞，如下方图表所示。

这导致了一些 Cloudflare 客户流量的丢包率升高，以及经过这些链路的流量延迟高于正常水平。除了拥塞之外，我们泄露了其前缀的网络，其流量也会被我们路由器上的防火墙过滤器丢弃，这些过滤器设计为只接受发往 Cloudflare 服务和我们客户的流量。在高峰时，我们在迈阿密的路由器上丢弃了大约 12Gbps 的、发往这些非下游前缀的入站流量。

### 后续措施与防止路由泄露

我们是 IETF 和基础设施社区内加强路由安全工作的坚定支持者和积极参与者。我们亲身了解意外导致路由泄露是多么容易，本次事件就是证明。

防止路由泄露需要多方面的方法，但我们已确定了多个可以改进的领域，包括短期和长期措施。

在我们的路由策略配置和自动化方面，我们正在：

*   修复导致路由泄露的路由策略自动化中的故障，并将立即缓解此潜在故障及其他类似故障
*   在我们的路由策略中实施额外的基于 BGP 团体属性的安全措施，明确拒绝在外部导出策略中从提供商和对等方接收的路由
*   将自动路由策略评估加入我们的 CI/CD 流水线，专门检查空或错误的策略条款
*   改进对网络配置问题以及自动化变更负面影响的早期检测

为了帮助总体上防止路由泄露，我们正在：

*   验证路由设备厂商对 RFC9234（BGP 角色和仅对客户属性）的实现，为我们部署该功能做准备，这是**独立于路由策略**、防止在**本地**自治系统（AS）层面引起路由泄露的唯一方法
*   鼓励长期采用 RPKI 自治系统提供商授权（ASPA），网络可以借此自动拒绝包含异常 AS 路径的路由

最重要的是，我们再次为给 Cloudflare 的用户和客户造成的影响，以及对外部网络造成的任何影响表示歉意。

---

> 本文由AI自动翻译，原文链接：[Route leak incident on January 22, 2026](https://blog.cloudflare.com/route-leak-incident-january-22-2026/)
> 
> 翻译时间：2026-01-24 04:30
