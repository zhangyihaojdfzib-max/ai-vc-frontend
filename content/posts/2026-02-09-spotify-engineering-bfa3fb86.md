---
title: Spotify应用发布流程揭秘：发布管理仪表盘的技术架构
title_original: 'How We Release the Spotify App: A Look Under the Hood (Part 2) |
  Spotify Engineering'
date: '2026-02-09'
source: Spotify Engineering
source_url: https://engineering.atspotify.com/2026/2/how-we-release-the-spotify-app-part-2/
author: ''
summary: 本文深入介绍了Spotify为优化应用发布流程而构建的“发布管理仪表盘”。文章阐述了该仪表盘如何解决早期依赖Jira导致的上下文切换频繁、信息过载等问题，通过整合多个系统的数据，为发布经理提供统一的决策视图。仪表盘基于Backstage平台开发，采用React和TypeScript，后端通过API网关聚合约10个系统的数据，并经过缓存优化将加载时间大幅缩短。核心功能包括展示各发布轨道的状态、阻塞性缺陷、质量与使用指标，旨在降低认知负荷，支持快速决策。
categories:
- 技术趋势
tags:
- 软件工程
- DevOps
- 发布管理
- Spotify
- Backstage
draft: false
translated_at: '2026-02-10T04:39:24.313020'
---

# Spotify应用发布流程揭秘（下篇）

![功能图片](/images/posts/17b841d0a52e.jpg)

## 引言

在《Spotify应用发布流程揭秘》上篇中，我们概述了Spotify的发布流程。在下篇中，我们将深入探讨支撑这一流程的技术工具。

要理解我们当前的系统，有必要回顾一下现有解决方案的历史背景。

在"发布管理仪表盘"出现前的"黑暗时代"，所有工作都依赖Jira。真的是所有工作。尽管Jira功能强大（有时甚至过于强大），但它难以用友好的方式呈现大量信息。这使得发布经理不得不在多个标签页间切换，在不同工单间跳转，检查各种状态——同时还要在Slack上回答各团队的问题。

![Jira发布工单的一小部分。](/images/posts/e3b04cbd8a7f.png)

Jira发布工单的一小部分。

这导致了大量的上下文切换，很容易遗漏Jira工单中的微小细节，从而引发额外工作。因此，当我们开始为发布经理构建新的指挥中心时，我们的目标是创建一个能够实现以下功能的单一网页：

- 为发布经理优化，但对任何了解Spotify移动端发布流程基本知识的人都直观易用
- 最小化上下文切换
- 降低认知负荷
- 支持快速准确的决策

这意味着我们进入了软件开发生命周期中最困难的部分——命名。运用我们卓越的命名技巧，我们想到："这有点像发布管理的仪表盘——那就叫它'发布管理仪表盘'吧。"

## 数据

我们希望在同一页面展示的数据，是发布经理过去需要为每个发布版本和平台（Android、iOS或桌面端）手动检查的所有信息。尽管所有平台共享一些通用库，但每个平台都是独立发布的。我们将平台和版本的组合称为一个"轨道"。

### 轨道特定数据

首先，我们有发布状态，这表示轨道在发布流程中的进展程度。每个轨道在正式推出前都会经历多个状态，如下图所示：

![How we release the Spotify app_part 2_progress.png](/images/posts/527be53bca95.png)

发布经理需要频繁检查未解决的发布阻塞性缺陷（即当前版本必须修复的关键缺陷）以及签核状态（显示哪些团队尚未完成回归测试）。

一旦这些工作完成，重点就转移到准备最终的候选发布版本构建。在最后一个修复被合并后，候选发布版本必须成功构建，通过构建验证测试，并成功上传到应用商店。

当构建可用后，关注点就转移到质量指标（如崩溃率、ANR和应用无响应）以及CPU异常率）和使用指标（如日活跃用户数），这些指标针对我们即将发布的构建。

### 未分配和未指定版本的缺陷

除了上述特定于某个轨道的数据外，我们还有未指定版本的开放阻塞性缺陷和未设置优先级的缺陷，因为它们也可能阻碍发布。这包括内部报告的缺陷和来自外部Alpha及Beta测试者的报告。发布管理流程的一部分就是尽可能为这些缺陷找到负责团队。有些工单确实很难找到负责人，在这种情况下，工单可能会先分配给某个团队，以帮助我们找到合适的负责人。

## 外观设计

由于Spotify拥有Backstage（我们的内部开发者门户），我们所有的内部前端需求都基于此，因此我们无需花费时间讨论使用哪个JavaScript框架。

具体来说，发布管理仪表盘是一个用React和TypeScript编写的Backstage插件。在内部，我们利用Backstage提供的软件目录功能来配置不同构建版本向应用商店的分发。我们还为应用构建和崩溃提供了包含更多细节的额外插件，并在发布管理仪表盘的相应部分提供链接。这些插件与我们其他面向应用的Backstage插件一起，通过共享的UI组件和数据，构成了一个为开发者服务的生态系统。

我们知道我们需要一个快速概览视图，以便查看发布是否进展顺利，是否准备好进入下一阶段，并且能够在出现问题时深入查看具体是什么在阻碍我们。基于这些需求，我们开始了工作。

![How we release the spotify app part 2 gif](/images/posts/2de7d2981b20.gif)

在上图所示的特定案例中，Android 8.9.74被标记为红色（不正常），因为其崩溃与ANR率过高。

## 后端

为了支撑发布管理仪表盘，我们构建了一个后端服务，它从大约10个现有系统中拉取并整合数据。作为一个API网关，它将关键的发布数据简化和聚合到一个统一、一致的API中。

我们的第一个版本虽然能用，但速度慢且成本高。每次重新加载都会触发大量的数据查询，导致加载时间长、成本高（大约相当于斯德哥尔摩一顿不错的午餐的费用！）。通过采用缓存和每五分钟预聚合数据的优化措施后，我们将加载时间缩短到仅八秒，并使仪表盘变得快速、可靠且使用成本低廉（低于一个土豆的成本！）。

## 细节

### 概览

让我们更深入地看看发布管理仪表盘目前的样子。

发布管理仪表盘在概览页面打开，可以一目了然地看到生产环境、当前和即将发布的版本状态。要查看详细信息，用户可以聚焦于他们感兴趣的轨道。

![How we release the spotify app_part 2_overview.png](/images/posts/3f1c4baf2591.png)

基本规则如下：

- 绿色：完成，准备好进入发布的下一阶段
- 黄色：警告，需要处理某些问题
- 红色：错误，需要纠正

### 生产环境

![How we release the spotify app_part 2_production.png](/images/posts/6f10e8e04f7b.png)

在顶部，我们显示Android、iOS和桌面端应用的生产环境版本。由于这些版本已经历了整个发布流程才进入生产环境，我们只显示指标，而不显示其发布流程的状态（它们都是绿色的——否则我们不可能走到这一步！）。我们显示过去24小时的崩溃指标和滚动日活跃用户数。这样，发布经理就能在发布后及时发现任何意外情况，并快速采取行动。

### 当前版本

![How we release the Spotify app_part 2_current](/images/posts/41980e721f34.png)

"当前版本"部分包含已创建分支但尚未部署到生产环境的应用程序版本。

在这个具体示例中，Spotify 8.9.2版本的iOS发布尚未完全就绪。存在一个发布阻塞性缺陷，回归测试尚未完成，且崩溃率超过了我们的发布阈值。开发人员仍在向发布分支推送修复，因此最新的构建版本不包含最近的提交。

黄色指示器表示我们正在等待某些事情发生（如缺陷修复、测试完成），红色指示器表示我们可能需要采取直接行动——例如，找出崩溃率超出阈值的原因。

ITGC（IT一般控制）部分确保只有在发布版本成功通过ITGC测试后，才能进行完整生产上线，以验证报告准确性并确认数据丢失低于既定阈值。

发布状态推送并非常规板块，而是一个实用链接，可生成包含发布状态的Slack消息。

### 即将发布

![How we release the Spotify app_part 2_upcoming](/images/posts/c6d0e4621d80.png)

"即将发布"板块与"当前发布"板块结构相同，但由于部分环节尚未生效，相关区域会显示为灰色。

## 深度洞察

每五分钟获取并保存发布数据形成了时间序列数据集，使我们能够量化发布流程并定位时间损耗环节。分析显示发布周期中最耗时的环节如下：

- 测试与修复阻塞性缺陷
- 等待应用商店审核（此环节基本不受我方控制）

我们还发现，若前序步骤在非工作时间完成，手动推进发布可能导致长达12小时的延迟，这促使我们决定将该流程自动化。

## 自动化机器人

经过数日研讨，我们得出结论：自动化推进至下一环节的投入将在数月内收回成本，因此我们启动了名为"机器人"的自动化系统开发。

如前所述，我们的发布当前需经历五个状态才能完成上线：
1. 发布分支建立
2. 最终候选版本
3. 提交审核
4. 1%渐进发布
5. 100%全量发布

此外还需对两种异常状态进行建模以完善流程：
6. 发布暂停
7. 发布取消

推进至下一阶段需要满足特定条件并执行相应操作，这些操作可由发布经理手动执行或由发布系统自动完成。我们的"机器人"本质上是一个后端服务，它持续检测条件并在条件满足时触发后续操作。

以下为条件检测的示例：

条件：人工测试已签署通过，无未解决缺陷，自动化测试在发布分支的最新git提交上执行成功
操作：提交审核

完整的状态机较为复杂，此处展示简化版状态与条件示意图：

![how we release the spotify app part 2 flow chart](/images/posts/c6d0e4621d80.png)

通过实施发布流程自动化机器人，我们将平均发布周期缩短了约8小时。

## 未来展望

目前我们已在Spotify主应用的Android、iOS和桌面端使用发布经理仪表板，并计划将其推广至更多Spotify应用。为实现这一目标，我们需要增强其模块化能力，因为小型应用的发布流程通常比主应用更轻量化。

发布经理仪表板已运行五年，尽管目前已有现成的替代方案，但我们认为自主维护仍具有多重价值：

- 我们可以在不同Backstage视图间轻松链接和复用发布经理组件
- Backstage软件目录提供了发布经理仪表板所依赖的基础数据模型，其他团队可根据需要查询和展示发布数据。例如我们内部的Confidence系统就利用发布数据来评估新客户端版本对实验的影响
- 通过Backstage的Band Manager插件，我们可以访问Spotify的组织数据，这意味着能自动将缺陷分配给相关团队，并对关键工单的进展进行团队通知
- 低使用门槛：Spotify所有开发者都在使用Backstage。这看似微不足道，但将所有开发工具集中在一处确实能产生巨大影响

我们对发布经理仪表板的最终成果非常满意。它不仅实现了所有预期目标，还带来了额外价值。期待下一个五年！

---

> 本文由AI自动翻译，原文链接：[How We Release the Spotify App: A Look Under the Hood (Part 2) | Spotify Engineering](https://engineering.atspotify.com/2026/2/how-we-release-the-spotify-app-part-2/)
> 
> 翻译时间：2026-02-10 04:39
