---
title: 内置持久性：Vercel推出工作流开发套件
title_original: 'Built-in durability: Introducing Workflow Development Kit - Vercel'
date: '2025-10-23'
source: Vercel Blog
source_url: https://vercel.com/blog/introducing-workflow
author: ''
summary: 本文介绍了Vercel推出的开源TypeScript框架——工作流开发套件（WDK）。该框架旨在简化构建可靠异步函数（如AI智能体或数据管道）的复杂性，将持久性提升为语言级概念。通过“use
  workflow”和“use step”两个简单指令，开发者可将普通异步函数转变为持久化工作流，自动处理队列、重试和持久化层。WDK允许函数暂停数分钟甚至数月，在部署或崩溃后从停止处精确恢复，无需手动集成消息队列或调度器，大幅提升开发效率。
categories:
- AI基础设施
tags:
- Vercel
- 工作流引擎
- TypeScript
- 持久化
- 异步编程
draft: false
translated_at: '2026-02-09T04:33:31.324894'
---

构建可靠的软件不应要求掌握分布式系统。

然而，对于开发AI Agent（智能体）或数据管道的开发者而言，使异步函数变得可靠通常需要消息队列、重试逻辑和持久化层。添加这些基础设施所花费的时间往往比编写实际业务逻辑还要长。

**工作流开发套件** 是一个开源的TypeScript框架，它将持久性提升为语言级别的概念。它可以在任何框架、平台和运行时上运行。函数可以暂停数分钟甚至数月，在部署和崩溃后依然存活，并能从停止处精确恢复。

## 将异步函数转变为持久化工作流

WDK的核心在于引入了两个简单的指令，将普通的异步函数转变为持久化工作流，自动处理队列、重试逻辑和持久化层的工作。

`use workflow` 指令将一个函数定义为持久化工作流：

```
1export async function hailRide(requestId: string) {2  "use workflow";3
4  const request = await validateRideRequest(requestId);5  const trip = await assignDriver(request);6  const confirmation = await notifyRider(trip);7  const receipt = await createReceipt(trip);8
9  return receipt;10}
```

此示例定义了一个协调网约车流程中多个步骤的持久化工作流。每个步骤独立运行，并且能够在部署或故障期间持久保存、暂停和恢复。

该工作流函数调用了四个步骤函数。每个步骤都用 `use step` 定义，它标记了一个工作单元，能自动持久化进度并在失败时重试：

```
1async function validateRideRequest(requestId: string) {2  "use step";3  4  5  const response = await fetch(`https://api.example.com/rides/${requestId}`);6  7  if (!response.ok) throw new Error("Ride request validation failed");8
9  const request = await response.json();10  return { rider: request.rider, pickup: request.pickup };11}12
13async function assignDriver(request: any) {14  "use step";15  16}17
18async function notifyRider(trip: any) {19  "use step";20  21}22
23async function createReceipt(trip: any) {24  "use step";25  26}
```

每个步骤都独立运行，并在失败时自动重试。在此示例中，第一步通过调用外部API来验证乘车请求，后续步骤则分配司机、通知乘客并生成收据。

WDK将每个步骤编译成一个独立的API路由。输入和输出都会被记录，因此如果发生部署或崩溃，系统可以确定性地重放执行过程。

当步骤在单独的路由上执行时，工作流会暂停且不消耗任何资源。步骤完成后，工作流会自动从暂停处恢复。

这意味着你的工作流可以暂停数分钟，甚至数月。

```
1import { sleep } from "workflow";2
3export async function offerLoyaltyReward(riderId: string) {4  "use workflow";5  6  7  await sleep("3d"); 8
9  return { riderId, reward: "Ride Credit" };10}
```

有些工作流需要等待数小时或数天才能继续。此示例在向乘客发放忠诚度奖励前暂停执行三天，期间不消耗资源且不丢失状态。

WDK被设计成一个使用熟悉的JavaScript语义的轻量级框架。你可以像现在一样使用 `async` 和 `await`。无需编写YAML、定义状态机或学习新的编排语法。你只需声明你的逻辑应如何运行，WDK会处理其余的一切，而无需手动连接消息队列或调度器。

### Webhook：通过外部事件暂停与恢复

工作流通常需要等待外部数据（如支付确认、用户操作或第三方API响应）才能继续。使用WDK，你可以通过Webhook暂停工作流，直到数据到达。

Webhook创建一个监听传入请求的端点。当外部事件向该端点发送数据时，工作流会自动从暂停处恢复，无需轮询、消息队列或状态管理。

```
1import { createWebhook, fetch } from "workflow";2
3export async function validatePaymentMethod(rideId: string) {4  "use workflow";5
6  const webhook = createWebhook();7  8  9  await fetch("https://api.example-payments.com/validate-method", {10    method: "POST",11    body: JSON.stringify({ rideId, callback: webhook.url }),12  });13
14  15  const { request } = await webhook;16  const confirmation = await request.json();17
18  return { rideId, status: confirmation.status };19}
```

Webhook让工作流可以暂停，直到从外部服务接收到数据。在此，工作流将一个回调URL发送给支付提供商，等待验证，然后在收到确认后自动恢复。

## 默认可靠、持久且可观测

从首次触发到最终结果，工作流内部发生的一切都存储在事件日志中，并一目了然地呈现给你。

每个步骤、输入、输出、暂停和错误都被记录，并且易于访问——不仅通过API，还通过内置的CLI和Web UI进行可视化查看。

实时跟踪运行状态、追踪故障、分析性能指标，无需编写任何额外的代码。

![Vercel automatically detects when a function is durable and dynamically provisions the ideal infrastructure to support it in real time.](/images/posts/5db6f97bbc62.jpg)

![Vercel automatically detects when a function is durable and dynamically provisions the ideal infrastructure to support it in real time.](/images/posts/e2dd241309ae.jpg)

![Vercel automatically detects when a function is durable and dynamically provisions the ideal infrastructure to support it in real time.](/images/posts/736f72608cf7.jpg)

![Vercel automatically detects when a function is durable and dynamically provisions the ideal infrastructure to support it in real time.](/images/posts/95edabeea163.jpg)

## 工作流通过"世界"随处运行

WDK中的工作流设计为可在任何平台、框架和运行时上运行。每个称为"世界"的环境定义了如何处理执行、编排和持久化。这使得你的代码无需任何更改即可在不同运行时和云环境之间移植。

在本地开发期间，"本地世界"提供虚拟基础设施，使工作流无需配置队列或数据库即可执行。在生产环境中，"Vercel世界"使用框架定义的基础设施自动设置持久化、队列和路由。你在本地测试的同一代码在规模化部署时表现完全一致。

"世界"是可扩展的。你可以通过实现自定义的"世界"，在其他运行时或云提供商上构建和部署WDK。我们已在GitHub上发布了 **Postgres世界** 的参考实现，社区也已经使用像 **Jazz** 这样的数据库创建了第三方"世界"。

WDK遵循 **Vercel开放SDK** 的理念。没有供应商锁定。无论你在Vercel还是其他地方运行，你的工作流都保持可移植、可靠和可观测。

构建自然语言图像搜索

使用此模板构建一个AI驱动的图像搜索应用，具备自动描述生成和语义搜索索引功能。

立即部署

## 为需要智能与可靠性的系统而构建

**工作流开发套件** 专为必须兼具智能和可靠性的系统而设计。

需要在长时间上下文间进行推理的AI Agent（智能体），必须在API调用之间暂停。随时间推移摄取和嵌入数据的RAG（检索增强生成）管道，需要在长达数小时的处理过程中经受住崩溃。等待用户确认的商务系统，需要在不消耗资源的情况下暂停数天。

通过为JavaScript增添持久性语义，Workflow Development Kit消除了现代应用可靠性面临的最大障碍之一。它让开发者专注于业务逻辑，而非基础设施。您编写异步代码，WDK使其具备持久性——无论是在本地还是在Vercel上大规模运行。

可靠性历来是开发者必须绕道构建的特性。而借助WDK，它终于成为您可以依托构建的基石。

开始构建持久化工作流

使用熟悉的JavaScript构建可跨越部署周期与系统崩溃持续运行的工作流。无需消息队列、调度器或额外基础设施。

立即开始

---

> 本文由AI自动翻译，原文链接：[Built-in durability: Introducing Workflow Development Kit - Vercel](https://vercel.com/blog/introducing-workflow)
> 
> 翻译时间：2026-02-09 04:33
