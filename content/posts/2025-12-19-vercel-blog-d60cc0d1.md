---
title: Vercel悬赏百万美元挑战黑客，加固React2Shell漏洞防御
title_original: Our $1 million hacker challenge for React2Shell - Vercel
date: '2025-12-19'
source: Vercel Blog
source_url: https://vercel.com/blog/our-million-dollar-hacker-challenge-for-react2shell
author: Malte Ubl CTO; Vercel
summary: 本文介绍了Vercel针对高危漏洞React2Shell（CVE-2025-55182）所采取的多层防御措施。在漏洞披露后，其防火墙拦截了数百万次攻击。Vercel主动发起了一项公开漏洞赏金计划，支付100万美元与116名安全研究人员合作，发现了20种独特的WAF绕过技术并即时加固了防御。文章重点阐述了其深度请求检测层Seawall的快速响应机制，以及通过计算层纵深防御确保平台安全的方法，展现了Vercel在应对重大安全威胁时的主动防御策略与合作模式。
categories:
- AI基础设施
tags:
- 网络安全
- 漏洞防御
- React2Shell
- WAF
- 漏洞赏金
draft: false
translated_at: '2026-01-05T17:28:39.607Z'
---

8 分钟阅读时长

在 React2Shell 漏洞披露后的几周内，我们的防火墙拦截了超过 600 万次针对运行易受攻击版本 Next.js 部署的攻击尝试，其中在高峰期的 24 小时内就达到了 230 万次。

这得益于 Seawall——Vercel Web 应用程序防火墙（WAF）的深度请求检测层。我们与 116 位安全研究人员合作，寻找他们能发现的每一种 WAF 绕过方法，随着新技术的报告，我们在 48 小时内支付了超过 100 万美元，并向我们的 WAF 推送了 20 次独特的更新。他们发现的绕过技术现已永久添加到我们的防火墙中，保护平台上的每一次部署。

但 WAF 规则只是第一道防线。我们现在首次披露了 Vercel 平台上针对 RCE 的另一项纵深防御措施，它直接在计算层运行。来自这项纵深防御的数据使我们能够高度自信地断言，WAF 在防御 React2Shell 漏洞利用方面异常有效。

本文是关于我们为保护客户所构建的防御措施，以及它对 Vercel 未来安全的意义。

### 我们防御的对象

这个看起来奇怪的载荷让整个行业的许多人度过了许多不眠之夜：

```json
{
  0: {
    status: "resolved_model",
    reason: 0,
    _response: {
      _prefix: "console.log('☠️')//",
      _formData: {
        get: "$1:then:constructor",
      },
    },
    then: "$1:then",
    value: '{"then":"$B"}',
  },
  1: "$@0",
}
```

React2Shell 漏洞利用的 PoC 示例

这就是 React2Shell 载荷。将其发送到任何运行易受攻击的 React 服务器组件的服务器，那个 `console.log('☠️')` 字符串就会在服务器端被求值。该字符串几乎可以被替换为任何内容。运行程序、提取密钥、发起网络调用。CVE-2025-55182 的评分为 10.0 分（满分 10.0 分）。这几乎是可能发生的最糟糕情况。

在 CVE 被负责任地披露后，倒计时开始了。我们知道恶意行为者会竞相利用它，因此在公众知道任何问题之前，我们就与 AWS、Google、Microsoft、Cloudflare、Netlify、Fastly、Deno 等业界伙伴进行了合作。相互合作意味着，当协调的公开披露发生时，每个主要平台提供商都已经有了缓解措施，确保尽可能多的用户在打补丁之前就受到保护。

但我们也知道接下来会发生什么。当一个漏洞被披露后，安全研究人员、恶意行为者和好奇的旁观者会开始检查受影响的代码路径，寻找绕过方法和相关漏洞。几天之内，研究人员就在 React 服务器组件中发现了两个额外的漏洞，需要更多的补丁和 WAF 更新。

我们需要能够适应的防御措施。

### 5 万美元的赏金

与其等待 WAF 绕过方法在野外出现，我们决定控制补丁周期，并支付报酬让世界上最好的安全研究人员首先为我们找到它们。

决定做出后的几个小时内，我们就在 HackerOne 上启动了一个公开的漏洞赏金计划。启动这样的计划通常需要数周时间。HackerOne 的团队全天候工作以实现这一目标，据联合创始人 Michiel Prins 称，这是他们历史上最快的公开计划启动之一。

我们为每一种能绕过我们 WAF 防护的独特技术提供 5 万美元的赏金。赏金故意定得很高，旨在引导研究人员将精力转向负责任的披露，而不是黑市销售，并将那些无论如何都会探测我们防御的人转变为合作者。

这个计划奏效了。116 名研究人员参与其中，提交了 156 份报告。到计划关闭时，我们已经验证了 38 份负责任的披露，并为 20 种独特的绕过技术支付了 100 万美元。我们与其他平台提供商分享了这些技术，以便他们也能加强自己的防御。我们学到的经验不仅仅保护了 Vercel 的客户。

### Seawall：加固我们的 WAF

Seawall 是我们 WAF 的深度请求检测层，它检查请求载荷而不仅仅是头部，并在恶意模式到达您的应用程序之前将其拦截。

在收到每份 HackerOne 报告后，我们遵循一个可重复的流程：复现绕过方法、将其转换为测试用例、更新规则以拦截它、全球部署、等待下一份报告、重复。在赏金计划启动后的前 48 小时内，我们向 Seawall 推送了 20 次更新，随着我们优化流程，每个发现的平均响应时间从两小时下降到三十分钟。

大多数报告是在最初的 24 小时内提交的，当时研究人员正在测试新颖的变体。第二批报告在第二个 24 小时内数量较少。随后几天，随着人们深入挖掘边缘情况，出现了少量越来越复杂的技术。

让我们惊讶的一点是，AI 在复现报告的工作中变得多么有用。提交的报告通常依赖于容易被忽略的细微差别，并且利用条件可能非常具体。现代 AI 模型非常擅长梳理出这些细节并将其转换为可复现的测试用例。每一份经过验证的报告都变成了一个基于 Go 的单元测试，现在只要 Seawall 有更改，它就会在 CI 上运行。研究人员在此计划期间发现的技术，在赏金计划结束后很长一段时间内，仍将继续保护客户。

### 补充我们的纵深防御策略

为了进一步保护客户，我们部署了第二层防御，直接在计算层运行。这个运行时缓解层在应用程序内部运行，而不是在 WAF 层。因此，它不依赖于启发式方法，而是直接消除攻击所针对的代码求值向量。

React2Shell 依赖于 JavaScript 函数具有 `constructor` 属性这一事实，该属性可用于在运行时 `eval` 代码。运行时缓解措施在 React 渲染期间阻止了这种代码执行，从根本上切断了攻击向量。我们预计合法的应用程序永远不会使用这种能力，当我们试用该缓解措施时，我们在实践中没有看到任何触及此代码路径的情况，因此我们知道部署它是安全的。

Deno 的团队是第一个发布运行时缓解措施的，他们愿意分享细节，这让我们对我们已经在探索的方向充满信心。我们为 Node.js 调整了我们的实现，大规模验证了部署的安全性，然后将其分享给其他平台提供商，以便他们也能从中受益。

我们设置了专门的日志记录，每当运行时缓解措施触发时就会记录，并自动向安全团队发出警报。如果攻击者找到了一个在生产环境中实际有效的 WAF 绕过方法，运行时缓解措施会捕获它，我们会立即知道。

如今，这项缓解措施覆盖了 Vercel 上 96% 的流量。通过第二层防御的日志记录，我们实际上可以知道 WAF 在实践中何时被绕过，因此我们可以高度自信地断言，Vercel 的 WAF 在防御 React2Shell 漏洞利用方面非常有效。

### 阻止最复杂的绕过方法

HackerOne 计划吸引了来自世界各地的优秀研究人员。感谢所有参与并帮助 Seawall 变得更强大的人。

防御 React2Shell 的 WAF 核心工作是识别恶意载荷，同时允许合法的载荷。实际执行代码来检查并不可行，因此模式匹配和解析必须足够。对于研究人员来说，这意味着要找到从模式匹配中隐藏漏洞利用的方法。

React2Shell 的最初发现者 Lachlan Davidson 和他的研究伙伴 Sylvie 提交了两种我们想在此详细说明的绕过方法。它们既展示了构建安全 WAF 的挑战，也展示了所涉及的安全研究的创造力。

### 递归 UTF 编码

许多绕过方法试图通过用 JSON 中的 Unicode 表示替换常规字符来混淆解析器。

这相对容易进行规范化处理，大多数WAF默认就会这样做。
但如果你能对Unicode编码再进行Unicode编码呢？然后再重复一次呢？
Lachlan和Sylvie发现了一个可以利用的组件，它能强制React Flight协议对同一字符串执行重复的JSON解码。任何能抵御N层Unicode编码的WAF，都可以通过使用该组件N+1次来绕过。Seawall现在会递归解码，直到有效载荷完全规范化，从而彻底堵上了这类绕过方法。
值得注意的是，这种以及类似的绕过方法，还依赖于JavaScript内置的ReadableStream类极其微妙的行为：可以构造出错误的流数据块，这些数据块不会（与默认行为相反）终止流处理，然后利用流错误消息字符串化过程可被转化为函数调用利用组件这一事实。
Link to heading不使用冒号访问构造函数
React2Shell的核心RCE利用组件，使用React Flight协议基于冒号的属性访问语法来访问函数的constructor属性。这就是为什么漏洞利用代码中包含字符串`:constructor`，而WAF防护措施正是基于此字符串来检测恶意载荷。
绕过此防护的一种方法是找到一个完全不使用constructor属性的全新利用链，但至今无人能找到。Lachlan找到了另一种方法：从`:constructor`变为`constructor`。注意到冒号不见了吗？
他们通过发现一种方法来实现这一点，该方法利用特定于RSC解析上下文中webpack模块的类似组件，进行属性访问和字符串操作。WAF可以通过针对攻击链中更上游的字符串来检测这种方法，但这证明了攻击者在混淆载荷方面，其能力已超越了最初的概念验证。
Link to heading帮助客户升级：作为产品体验的安全
纵深防御为我们争取了时间，但唯一真正的解决方法是让人们升级。我们发布了安全公告作为唯一可信来源，提供了仪表板横幅来帮助识别易受攻击的部署，推出了CLI工具（`npx fix-react2shell-next`）来帮助修补易受攻击的应用程序，并通过Vercel Agent自动创建PR，以尽可能自动化这一过程。
Link to heading展望未来
React2Shell以我们无法模拟的方式考验了我们的安全基础设施。我们从中收获了一个久经考验的WAF、一个我们可以为未来漏洞进行调整的运行时防御层，以及一份应对下一个关键CVE的行动手册。
研究人员在HackerOne计划期间发现的绕过技术，现已永久添加到我们的防火墙中。跨行业合作为平台在网络遭受攻击时如何协同工作树立了典范。为帮助客户升级而发布的工具，现已成为我们应对任何安全事件流程的一部分。
但平台防护只能争取时间。它们是第一道防线，不能替代打补丁。如果您正在运行易受攻击的Next.js版本，请立即修补。
下一个关键漏洞终将到来，当它出现时，Vercel的客户可以相信，在他们进行修补的同时，我们将已部署好相应的防护措施。
Link to heading致谢
首先，衷心感谢Lachlan Davidson负责任地披露了React2Shell。他在披露后继续探查我们的防御，并提交了我们所见过的最高深复杂的绕过方法。
感谢参与我们HackerOne计划的每一位研究人员：hakikiwidya, luhko, lachlan2k, sy1vi3, maple3142, hacktronresearch, bugra, lonecat, ryotak, ch1axan, chilaxan, cjm00n, francisconeves97, phithon, shubs, 以及 hashkitten。
没有我们的合作伙伴，这次响应不可能实现：
HackerOne动员其团队，在不到六小时内启动了我们的漏洞赏金计划。这个过程通常需要数周。
Latacora IntrusionOps提供了关键的事件响应支持，帮助对提交的报告进行分类、验证和复现。
特别感谢Vercel首席财务官Marten Abrahamsen批准了100万美元的赏金支付。

---

> 本文由AI自动翻译，原文链接：[Our $1 million hacker challenge for React2Shell - Vercel](https://vercel.com/blog/our-million-dollar-hacker-challenge-for-react2shell)
> 
> 翻译时间：2026-01-05 17:28
