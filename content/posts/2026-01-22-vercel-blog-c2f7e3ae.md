---
title: 测试“只需bash”假说：混合AI Agent方案胜出
title_original: Testing if "bash is all you need" - Vercel
date: '2026-01-22'
source: Vercel Blog
source_url: https://vercel.com/blog/testing-if-bash-is-all-you-need
author: ''
summary: 本文通过对比SQL、Bash和文件系统三种AI Agent在查询GitHub issues数据集上的表现，探讨了“文件系统和bash是AI Agent最佳抽象”这一假说。实验发现，纯SQL
  Agent准确率最高，但Bash Agent因性能瓶颈和缺乏数据结构认知而表现不佳。最终，结合Bash探索与SQL查询的混合方法，通过自我验证实现了100%的可靠准确率，成为最稳健的方案。文章强调了上下文理解与工具组合对AI
  Agent效能的关键影响。
categories:
- AI研究
tags:
- AI Agent
- bash
- SQL
- 评估基准
- 混合系统
draft: false
translated_at: '2026-01-23T04:43:00.686183'
---

我们邀请了来自Braintrust的Ankur Goyal，分享他们如何测试AI Agent的“只需bash”假说。

AI社区日益确信，文件系统和bash是AI Agent的最佳抽象。其逻辑是合理的：LLM（大语言模型）在代码、终端和文件导航方面接受了大量训练，因此你应该能够给你的Agent一个shell并让它工作。

即使是非编码的Agent也可能从此方法中受益。Vercel最近关于使用文件系统和bash构建Agent的帖子展示了这一点，它将销售电话、支持工单和其他结构化数据映射到文件系统上。Agent通过grep搜索相关部分，提取所需内容，并按需构建上下文。

但还有一种值得测试的替代观点。文件系统可能是探索和检索上下文的正确抽象，但查询结构化数据呢？我们构建了一个评估工具来找出答案。

## 设置评估

我们让Agent负责查询一个包含GitHub issues和pull requests的数据集。这类半结构化数据反映了现实世界的用例，如客户支持工单或销售电话记录。

问题的复杂程度从：

- 简单查询：“有多少个提及‘安全’的开放issue？”
- 复杂查询：“查找有人报告了bug，随后有人提交了声称修复该bug的pull request的issue”

三种Agent方法进行了比较：

1. SQL Agent：对包含相同数据的SQLite数据库进行直接数据库查询
2. Bash Agent：使用just-bash在文件系统上导航和查询JSON文件
3. 文件系统Agent：使用基本文件工具（搜索、读取），无需完整的shell访问权限

每个Agent收到相同的问题，并根据准确性进行评分。

## 初步结果

SQL占据主导地位。它达到了100%的准确率，而bash仅达到53%。Bash还多使用了7倍的Token，成本高出6.5倍，同时运行时间长了9倍。即使是基本的文件系统工具（搜索、读取）也优于完整的bash访问，达到了63%的准确率。

你可以直接探索SQL实验、bash实验和文件系统实验的结果。

一个令人惊讶的发现是，bash Agent生成了高度复杂的shell命令，以在典型Agent工作流中很少出现的方式链式使用find、grep、jq、awk和xargs。模型显然对shell脚本有深入的了解，但这种知识并未转化为更好的任务性能。

![未转化为准确性的复杂shell脚本](/images/posts/028a586db147.avif)

## 调试结果

评估揭示了一些需要关注的实际问题。

**性能瓶颈**。本应在毫秒内运行的命令在10秒后超时。对68,000个文件的stat()调用是罪魁祸首。just-bash工具收到了解决此问题的优化。

**缺少模式上下文**。Bash Agent不知道它正在查询的JSON文件的结构。在系统提示词中添加模式信息和示例命令有所帮助，但不足以缩小差距。

**评估评分问题**。手动检查失败案例发现，有几个问题的“预期”答案实际上是错误的，或者Agent找到了额外的有效结果但评分者却扣了分。五个问题得到了修正，解决了模糊性或数据集不匹配的问题。

- “哪些仓库拥有最多的独立issue报告者”在组织级别和仓库级别分组上存在歧义
- 几个问题的预期输出与实际数据集不匹配
- Bash Agent有时找到的有效结果比参考答案包含的更多

Vercel团队提交了一个包含修正的PR。

在对just-bash和评估本身进行修复后，性能差距显著缩小。

## 混合方法

然后我们尝试了一个不同的想法。不是选择一种抽象，而是给Agent两者：

- 让它使用bash来探索和操作文件
- 在合适的时候也提供对SQLite数据库的访问

混合Agent发展出一种有趣的行为。它会运行SQL查询，然后通过grep文件系统来验证结果。这种双重检查是混合方法始终达到100%准确率的原因，而纯SQL偶尔会出错。

你可以直接探索混合实验结果。

代价是成本。混合方法使用的Token数大约是纯SQL的两倍，因为它需要推理工具选择并验证其工作。

## 关键收获

在对just-bash、评估数据集和数据加载问题进行所有修复之后，bash-sqlite组合成为最可靠的方法。“赢家”不是单次运行的原始准确率，而是通过自我验证实现的一致准确率。

![混合方法在准确率上与SQL相当，同时增加了自我验证](/images/posts/dbaa8b3e4b75.avif)

经过200多条消息和数百次追踪后，我们：

- 修复了just-bash中的性能瓶颈
- 纠正了评估中五个模糊或错误的预期答案
- 发现了一个导致差一错误的数据加载bug
- 观察到Agent制定了复杂的验证策略

Bash Agent检查自身工作的倾向被证明是有价值的——不仅是为了准确性，也是为了发现那些在纯SQL方法中会被忽视的问题。

## 这对Agent设计意味着什么

对于具有明确模式的结构化数据，SQL仍然是最直接的途径。它速度快、易于理解，并且使用更少的Token。

对于探索和验证，bash提供了SQL无法比拟的灵活性。Agent可以通过文件系统访问来检查文件、抽查结果并发现边缘情况。

但更大的教训是关于评估本身。Braintrust和Vercel团队之间的反复交流，以及每一步的详细追踪，才是真正改进工具和基准的原因。如果没有这种可见性，我们可能仍在基于有缺陷的数据争论哪种抽象“胜出”。

## 运行你自己的基准测试

该评估工具是开源的。

你可以替换你自己的：

- 数据集（客户工单、销售电话、日志，任何你正在处理的数据）
- Agent实现
- 对你的用例重要的问题

本文由Ankur Goyal和Braintrust团队撰写，他们为AI应用构建评估基础设施。该评估工具是开源的，并与Vercel的just-bash集成。

---

> 本文由AI自动翻译，原文链接：[Testing if "bash is all you need" - Vercel](https://vercel.com/blog/testing-if-bash-is-all-you-need)
> 
> 翻译时间：2026-01-23 04:43
