---
title: 使用Vercel AI网关构建AI生成像素交易卡
title_original: Building AI-Generated Pixel Trading Cards with Vercel AI Gateway -
  Vercel
date: '2025-12-23'
source: Vercel Blog
source_url: https://vercel.com/blog/pixel-portraits-ai-generated-trading-cards
author: Daniel Linthwaite Brand Designer
summary: 本文介绍了Vercel团队如何将AI技术与怀旧像素艺术结合，为Next.js Conf和Ship AI活动打造个性化像素肖像收藏卡体验。文章详细阐述了从现场拍照亭捕捉图像、使用flux-kontext-lora模型和自定义LoRA生成像素风格肖像、通过BRIA模型移除背景、利用Canvas
  API合成品牌卡片，到现场打印交付的完整工作流程。此外，团队还将该体验转化为线上v0模板，由Vercel AI Gateway和Fal提供支持，允许用户通过网络摄像头或上传图像生成专属像素卡片，实现了从线下活动到线上工具的扩展。
categories:
- AI产品
tags:
- Vercel
- AI生成图像
- 像素艺术
- AI网关
- 开发者工具
draft: false
translated_at: '2026-01-05T16:35:07.400Z'
---

5 分钟阅读
在我们最近的 Next.js Conf 和 Ship AI 活动上，我们推出了一项融合技术实验与怀旧趣味的互动体验。这个想法的诞生远早于任何人踏入会场。作为这两场活动在线注册体验的一部分，参会者可以输入提示词并生成自己的收藏卡，让他们提前感受这种形式，并为我们想要带入现实世界的构想奠定基础。

乘此势头，我们的团队打造了一个像素肖像收藏卡体验，旨在扩展到数千名参会者，同时仍保持个性化体验。其核心是一个由 AI 驱动的拍照亭，它能捕捉每位参与者的肖像，将其转换为定制的像素风格渲染图，并按需打印成可收藏的卡片。每张卡片都被封装在一个受 PSA 启发的保护套内，并附上每位参会者独有的序列化评级标签。

这不仅仅是一个纪念品。它变成了一个轻量级的系统，用于生成用户主导的故事叙述，让参会者融入品牌并亲自将其传播出去。随着这些卡片在社交媒体渠道上传播，它们变成了活动微小而引人注目的信号，每一张都是我们想要创造的体验的袖珍版：技术精湛、触手可及，且带有我们鲜明的印记。

在走到拍照亭前、几秒钟后收到收藏卡这一简单步骤的背后，是一个精心编排的流程，涵盖了 AI 生成、图像处理和现场制作。每一步都设计得快速、可预测，并且对参会者来说是隐形的。

流程从某人摆好姿势拍照的那一刻开始。捕捉到的图像被发送到我们的生成流程中，该流程使用了 flux-kontext-lora 模型，并结合了一个在怀旧的 16 位像素艺术风格上训练过的自定义 LoRA。系统生成一个保留参会者外貌特征的像素肖像，并将其呈现在亮绿色背景上，以便进行下游处理。

随后，BRIA 的 RMBG 2.0 模型移除了绿幕，将人物分离出来以便合成。Canvas API 通过将像素肖像与活动背景图案和品牌叠加层分层，来组装收藏卡。使用 sharp 图像库应用的自定义渐变映射为每个活动创建了最终的颜色标识。完成的 PNG 图像随后被发送到现场打印机，整个数字工作流程大约在六秒内完成。参会者还可以扫描二维码保存卡片的数字版本。

工作流程的实体部分完善了整个体验。每张打印出来的卡片都经过手工模切，以实现经典收藏卡熟悉的圆角轮廓。为了简化生产流程，我们在活动前预先打印了连续的评级标签。这些标签已经贴在受 PSA 启发的亚克力保护套上，工作人员可以快速将卡片滑入套中并交付给参会者。

将像素肖像引入 v0
活动结束后，我们希望像素肖像不仅仅是一个线下瞬间。为此，我们构建了一个 v0 模板，将相同的构想带入浏览器，并由 Vercel AI Gateway 和 Fal 集成提供端到端的支持。

工作原理：
图像输入：用户可以使用网络摄像头拍照，或上传/粘贴/拖放图像。应用程序会将其裁剪为适合卡片的长宽比，并转换为 base64 数据 URL。
风格参考：加载并编码一个预制的像素艺术参考图像（`style_reference.png`）。这作为期望的 16 位外观的视觉锚点。GPT Image 1.5 编辑：模型首先接收用户图像，然后是风格参考图像，同时附带一个提示词，该提示词强制执行诸如有限颜色、清晰像素和一致构图等约束。
合成：输出通过背景移除（BRIA）进行清理，然后合成到带有品牌标识的卡片框架上，并通过渐变映射生成最终的 Next.js 和 Vercel 变体。

```javascript
// app/actions.ts
"use server"
import * as fal from "@fal-ai/serverless-client"

// 使用您的 API 密钥配置 fal.ai
fal.config({
  credentials: process.env.FAL_KEY,
})

// 将照片转换为像素艺术的提示词
const PIXEL_ART_PROMPT = `图像角色
图像 1（用户照片）：身份、面部几何结构、比例、发际线、发型、轮廓和可识别相似度的唯一来源。
图像 2（参考图像）：仅提供像素网格、色彩规范、构图框架、比例和构图方案。
步骤 1：身份投射
将用户照片投射到粗糙的 24×24 像素网格上，保留用户精确的面部几何结构：头部宽度、下颌形状、脸颊结构、眼间距、鼻子宽度、嘴巴位置、发际线和整体轮廓。
每个主要面部区域（前额、脸颊、鼻子、下颌、头发主体）必须解析为少量的大像素块，而非精细细节。此步骤仅定义身份和几何结构。
```

无风格平均化。
第二步：像素格式化
使用超块状16位像素艺术规则格式化投影身份，匹配参考图像的像素尺寸、构图框架、比例和负空间，且不改变身份几何结构。
将肖像视为手工放置的像素艺术，而非经过滤镜处理的图像。
像素艺术规则
- 总共最多使用10种颜色
- 渲染时如同以24×24像素创建，然后无平滑放大
- 所有像素必须大、清晰且呈完美正方形
- 像素邻接必须硬朗、阶梯状且呈块状，无混合、插值或羽化
- 不要将像素簇细分为更小的内部细节
- 无抖动，无渐变，无柔和阴影
阴影必须经过海报化处理且最小化，每个面部区域最多使用1种高光色调和1种阴影色调。
应用右侧光源照明，使脸部左侧更暗，使用大而清晰分离的像素块来表达对比度。
面部构建
将头发、胡须和面部特征构建为大型几何像素簇，这些像素簇直接源自用户照片的真实轮廓。
头发必须呈现为单个或极少数的大块形状，而非许多相互交错的碎片。
像素簇的尺度可以匹配参考图像，但簇的形状必须遵循用户的几何结构，而非参考图像的。
面部特征必须保持可识别性，但用尽可能少的像素表达：眼间距、眉毛角度、鼻宽、嘴型、下颌线和发际线必须清晰地映射到用户照片，不添加额外细节。
使用经典复古游戏比例：简化形式、粗轮廓、最少细节、相对于分辨率略微放大的眼睛。
渲染约束
- 无照片级真实感纹理
- 无发丝、毛孔、皱纹、微阴影或平滑曲线
- 无次级高光或轮廓修饰
- 在头部、面部特征和服装轮廓周围使用粗像素轮廓线
- 角色面朝前方
- 人物居中于纯绿色背景上
服装
服装必须匹配用户照片中的类型和轮廓，但完全以黑色渲染，最多使用两种深色调进行最小化的像素艺术阴影。

```javascript
// Load the style reference image as base64
async function getStyleReferenceBase64(): Promise<string> {
  const baseUrl = process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : "http://localhost:3000"
  const response = await fetch(`${baseUrl}/style_reference.png`)
  const blob = await response.blob()
  const buffer = await blob.arrayBuffer()
  const base64 = btoa(String.fromCharCode(...new Uint8Array(buffer)))
  return `data:image/png;base64,${base64}`
}

export async function generatePixelPortrait(userImageDataUrl: string) {
  // Load the style reference image
  const styleReference = await getStyleReferenceBase64()

  // Call fal.ai's GPT Image 1.5 Edit model
  // Pass user image first, style reference second
  const result = await fal.subscribe("fal-ai/gpt-image-1.5/edit", {
    input: {
      prompt: PIXEL_ART_PROMPT,
      image_urls: [userImageDataUrl, styleReference],
      image_size: "auto",
      quality: "high",
      input_fidelity: "high",
      num_images: 1,
      output_format: "png",
    },
  })

  return result.images[0].url
}
```

从用户的角度来看，模板很简单：上传或自拍一张照片，然后看着它变成一张复古交易卡。关键在于将用户图像与一个单一、一致的风格参考图像配对。该参考图像确保了在各种输入下输出的稳定性，而提示词则完成了其余的约束工作，以避免“通用像素化”，并最终呈现出一种有意为之的精灵艺术效果。

此后，应用程序的其余部分是关于呈现的：为获得干净的合成效果而进行的背景移除、浏览器中的卡框图层叠加，以及为两种品牌变体进行的渐变映射。最终结果是一个小巧、可复刻的项目，展示了通过几个目标明确的步骤和一个清晰的风格目标，你能走多远。

复刻v0模板，亲自尝试像素肖像。连接你的Fal.ai API密钥来运行生成，并尝试不同的提示词、模型和风格参考。

链接到标题Vercelf Yourself：一个节日复刻版
有了这个模板，相同的构建块自然成为了季节性实验的基础。为了节日，我们创建了Vercelf Yourself，这是一个衍生项目，可以将你的照片变成节日风格的16位像素肖像。

Vercelf Yourself使用了与模板相同的风格参考方法，但通过多个滤镜进行了扩展。每个滤镜（Vercelf、Comfy、Santa、Wham!）都有自己的参考图像和量身定制的提示词，都旨在实现严格的黑白灰、以Vercel品牌为导向的美学。提示词控制着比例、裁剪和构图等细节，同时保留原始图像中可识别的特征。这种组合既保持了结果的一致性，又赋予了每个滤镜独特的个性。

Wham!滤镜提示词结构：
将参考图像中展示的相同16位像素艺术肖像风格应用于用户照片。匹配风格参考中角色的比例、裁剪和构图，使肖像在视觉上与参考图像对齐。最终生成的图像必须严格为黑白灰，仅使用黑色、灰色和白色。不引入任何颜色。角色应面朝前方，并穿着受Wham!乐队《Last Christmas》视频启发的蓬松黑色毛皮外套。在肖像左侧前景添加两个黑白复古1980年代滑雪板，垂直放置，仿佛角色正握着它们。在角色的右耳添加一个银色圆环耳环。将发型更新为受80年代风格启发的用户发型版本，同时保持其可识别性。保留用户照片中的可识别属性，包括肤色和面部特征，使像素角色清晰可辨地像本人。将人物居中放置在带有深灰色雪花图案的黑色背景上。

在实现方面，该应用程序通过Vercel AI网关和AI SDK使用Gemini图像生成，以保持集成的简洁性。请求的核心部分如下所示：

```javascript
const result = await generateText({
  model: "google/gemini-3-pro-image",
  messages: [
    {
      role: "user",
      content: [
        { type: "image", image: userImage },
        { type: "image", image: styleReferenceImage },
        { type: "text", text: prompt },
      ],
    },
  ],
})
```

AI网关在幕后处理路由、身份验证和响应格式化。由于接口在不同提供商之间保持一致，我们可以尝试不同的模型或稍后更新技术栈，而无需重写应用程序。这让我们可以自由地专注于用户体验的感受，而不是其内部如何连接。

在Vercelf Yourself应用程序中创建你自己的节日肖像。你每天最多可以生成三张图像，或者复刻v0模板，使用你自己的AI网关设置来尝试滤镜、提示词和模型。

链接到标题总结
像素肖像始于一次线下活动，并演变成一套可复用的模式，用于构建小型、个性化的AI体验：清晰的视觉锚点、受约束的提示词、简单的流程，以及恰到好处的用户界面，使整个体验易于上手。

这些相同的模式现在支撑着一个v0模板、一个节日版的Vercelf Yourself变体，以及我们接下来决定接入该流程的任何其他项目。

节日快乐！

---

> 本文由AI自动翻译，原文链接：[Building AI-Generated Pixel Trading Cards with Vercel AI Gateway - Vercel](https://vercel.com/blog/pixel-portraits-ai-generated-trading-cards)
> 
> 翻译时间：2026-01-05 13:30
