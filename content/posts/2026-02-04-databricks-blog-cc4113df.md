---
title: AI/BI仪表板性能优化十大最佳实践（下）：平台与数据层优化
title_original: The Top 10 Best Practices for AI/BI Dashboards Performance Optimization
  (Part 2)
date: '2026-02-04'
source: Databricks Blog
source_url: https://www.databricks.com/blog/top-10-best-practices-aibi-dashboards-performance-optimization-part-2
author: ''
summary: 本文是Databricks AI/BI仪表板性能优化系列的第二部分，聚焦于平台基础与数据层优化，以确保仪表板在用量增长时保持高性能。文章详细探讨了如何根据工作负载形态选择与设计匹配的仓库配置（推荐使用Serverless），应用以整型连接键为核心的星型数据建模最佳实践，以及通过优化Parquet文件布局（如文件大小和聚类）来减少数据扫描量。这些措施共同为实现稳定、可预测的大规模仪表板性能奠定了基础。
categories:
- AI基础设施
tags:
- 性能优化
- 数据仓库
- 数据建模
- Databricks
- BI仪表板
draft: false
translated_at: '2026-02-05T04:18:23.011727'
---

本文是关于大规模优化 Databricks AI/BI 仪表板性能系列文章的第二部分。

在上一篇文章中，我们重点探讨了布局、筛选器、参数和缓存如何决定系统为每次点击所需完成的工作量。这些优化通常足以让仪表板感觉响应迅速。

在本文中，我们将重点转向平台基础，以确保仪表板在用量增长时仍能保持高性能。我们将探讨仓库选择与规模调整、数据建模与模式选择、文件布局与聚类，以及何时应依赖物化而非重新计算，以实现稳定、可预测的性能。

## 优化 #6：选择与设计匹配的仓库配置

将仪表板的形态（页面数量、查询组合、用户突发性）与 DBSQL 仓库类型和规模相匹配，以便系统能快速接纳工作负载而无需排队。

由于可见的部件会一起提交，仪表板自然会生成短暂的并发峰值。如果仓库无法吸收这种突发负载，您将看到查询排队（峰值排队查询数 > 0）以及图块加载时间不一致——尤其是在高峰时段。

### DBSQL 仓库并发工作原理

-   Serverless + IWM：Serverless 使用智能工作负载管理来预测成本、接纳和优先处理查询，并快速自动扩缩容。典型的启动时间为 2–6 秒，因此突发负载能保持低延迟，无需手动调优。
-   Pro/Classic：固定的“每个集群 10 个并发查询”门控，自动扩缩容基于分钟级阈值添加集群，启动需要数分钟。请根据预期并发量规划容量，并避免在页面加载时出现激增。
-   监控与规模调整：关注“峰值排队查询数”和“查询历史记录”，如果峰值持续高于 0，请增加集群规模（特别是当查询配置文件显示溢出到磁盘时）或提高最大集群数。

### 为何首选 Serverless

-   **推荐将 Serverless 用于交互式 BI**：启动最快，通过 IWM 实现动态并发，以及更高效的 I/O。

### 实用的规模调整启发式方法

-   开始时选择较大（集群规模），测试后再缩小规模；让 Serverless 自动扩缩容处理并发突发；仅当排队峰值持续存在时才增加最大集群数。
-   将繁重的 ETL 和 BI 工作负载分开：为每个工作负载/领域**专用** Serverless 仓库（避免缓存污染，并让 IWM 学习工作负载模式）。
-   优先处理小型、频繁的查询：Serverless IWM 保护短时交互，并在混合负载期间快速扩缩容；设计页面时，让概览页首先执行最轻量的图块。

更多详情，请参阅：https://docs.databricks.com/aws/en/compute/sql-warehouse/warehouse-behavior

## 优化 #7：应用数据建模最佳实践

设计良好的数据模型是 AI/BI 仪表板的基础性能特性。星型模式仍然是交互式分析最有效、最可预测的建模模式，因为它直接与 BI 查询的编写和优化方式保持一致。

在星型模式中，中心的事实表包含可度量的事件（销售、交易、点击），并与周围的维度表（日期、客户、产品、地区）进行连接。这种结构最大限度地减少了连接复杂性，减少了数据重复，并通过简单、稳定的查询模式实现高效聚合。因此，仪表板执行的连接更少，扫描的数据更少，并能更稳定地从缓存和查询优化中受益。

一个关键但常被忽视的细节是连接键的数据类型。维度表和事实表的连接应使用基于整型的代理键，而非字符串。整型连接速度显著更快，所需内存更少，能提高缓存效率，并允许 Photon 使用高度优化的向量化路径执行连接。基于字符串的连接会增加 CPU 成本，并可能随着数据和并发量的增长成为隐藏的瓶颈。

在 Databricks 中，这种模式与 Lakehouse 架构自然契合。黄金层应建模为事实和维度，存储为 Unity Catalog 表，为 AI/BI 仪表板、指标视图和物化视图提供一个受治理、可重用的语义基础。

结论很简单：根据 BI 查询的实际运行方式进行建模。在黄金层使用整型连接键的星型模式能带来更简单的 SQL、更快的连接以及大规模下更可预测的性能。

## 优化 #8：Parquet 优化技术

设计数据布局，使仪表板每次查询读取的数据量大幅减少，然后让引擎利用 Parquet 统计信息和选择性读取。

### 将文件布局视为性能特性

当 Databricks SQL 能够做到以下几点时，其性能最佳：

-   使用元数据（最小/最大统计信息）修剪整个文件，
-   高效读取大型连续的数据块，
-   避免打开数千个小文件。

因此，最大的两个优化点是：**将文件压缩到最佳大小**，以及**对数据进行聚类**以便谓词能修剪文件。

更多详情请参阅：https://www.databricks.com/discover/pages/optimize-data-workloads-guide

一个典型的反模式：像 `WHERE customer_id = ?` 这样的仪表板筛选器看起来具有选择性，但如果数据没有经过聚类，引擎仍然需要处理大部分文件，因为匹配的行分散在各处。

### 技术

-   使用 **Photon** 以受益于 Parquet 的内置**预测性 I/O**：Photon 应用 AI 辅助的选择性读取和并行 I/O 来跳过不匹配的数据块并列出更少的文件，无需手动索引即可实现快速的选择性扫描。
-   为托管表启用预测性优化：Databricks 可以根据观察到的工作负载模式自动调度和执行表维护——**OPTIMIZE**（压缩以保持文件大小健康）、**ANALYZE**（更新统计信息）、**VACUUM**（清理）和**Liquid Clustering**（自适应布局）——使您无需手动调优，同时在大规模下提高读取的价格/性能比。实际上，这有助于通过主动压缩小文件（通过 OPTIMIZE）来保持文件大小健康，从而使 Parquet 元数据（页脚 + 最小/最大统计信息）在数据跳过、选择性扫描以及 BI 扫描/并发方面保持有效。
-   在需要时手动触发相同的操作：当您需要更严格的控制或更快的见效时间时（例如，在大规模数据摄取/回填、模式更改之后，或在已知的报告高峰之前），您仍然可以自己运行 **OPTIMIZE** 和 **ANALYZE** 等命令。关键在于要有计划性：使维护节奏与表的变更频率保持一致，并确保计算成本能被下游在并发性、延迟和扫描效率方面的收益所证明。
-   采用 **Liquid Clustering** 替代繁重的分区。Liquid 会增量式地对数据进行聚类以支持点查找和选择性扫描，您可以随时更改聚类列（即使是高基数列）而无需完全重写，布局会随着使用情况的变化而自适应。
-   使布局与仪表板谓词保持一致。选择反映常见筛选/分组维度（例如，日期、客户、地区）的 Liquid 聚类列，以便预测性 I/O 能为“调查”和“深入分析”页面跳过大量数据。

结果：处理更少的文件，跳过更多的数据块，在获得相同洞察的同时缩短实际耗时，且无需脆弱的索引或手动调优。

更多详情，请参阅：

-   https://www.databricks.com/blog/faster-lakeview-dashboards-materialized-views
-   https://docs.databricks.com/aws/en/compute/photon
-   https://docs.databricks.com/aws/en/delta/data-skipping
-   https://docs.databricks.com/aws/en/delta/optimize

## 优化 #9：利用指标视图物化

在**优化 #7：应用数据建模最佳实践**中，我们重点讨论了具有明确定义的事实、维度和 KPI 的星型模式的重要性。指标视图是这些原则在 Databricks AI/BI 中的直接延续。

**指标视图**围绕 BI 语义设计：它们由度量和维度组成，使其成为建模 KPI 的自然抽象。它们允许团队一次性定义业务指标，并在多个仪表板、Agent（智能体）和其他客户端工具中一致地复用相同的 KPI。这减少了重复，防止了 KPI 漂移，并随着采用规模的扩大，保持了分析逻辑的一致性。

通过指标视图的物化功能，Databricks 能够自动预计算并维护常用的聚合结果。这些聚合结果会进行增量更新，并且在查询时，优化器会透明地将仪表板查询重写为匹配度最高的预计算结果。因此，仪表板查询每次交互所需扫描的数据量大幅减少——无需团队管理独立的聚合表或自定义流水线。

如果不使用指标视图，也可以采用物化视图实现相同的方法。例如，可以预计算并存储大型事实表的聚合版本，使仪表板能够查询一个更小、更优化的数据集。这通过减少数据扫描量显著提升了性能，并避免了为每次用户交互重复计算开销巨大的聚合操作。

所有这些技术都旨在优化同一件事：**减少数据扫描量**。通过一次性定义关键绩效指标，并使用指标视图或物化视图预计算常用聚合结果，仪表板可以避免重复聚合大型事实表。扫描的字节数越少，直接意味着查询速度更快、延迟更可预测，以及在大规模场景下性能更佳。

- https://docs.databricks.com/aws/en/metric-views/materialization

## 优化技巧 #10：优化数据类型

数据类型直接影响 Databricks SQL 为每次仪表板查询所需读取、移动和处理的数据量。即使 SQL 语句和缓存策略都完美无缺，低效的数据类型也会悄无声息地增加 IO、内存压力和 CPU 成本——表现为图块加载变慢和并发能力下降。

在底层，Databricks SQL 操作的是列式 Parquet 文件。选择更小、更合适的数据类型意味着：

- 从存储中扫描的数据更少（列更窄），
- 缓存密度更高（内存和结果缓存中能容纳更多值），
- Photon 中的向量化执行速度更快（对 SIMD 友好的布局），
- 数据跳过更有效，因为最小/最大统计值的范围更精确。

以下几点机制最为关键：

- 尽可能使用 INT / BIGINT 而非 STRING 作为标识符。字符串的扫描、比较和缓存成本高昂；数字键的成本则要低几个数量级。
- 优先使用 DATE 或 TIMESTAMP 而非基于字符串的日期。原生的时间类型支持谓词下推、高效比较和更好的数据剪枝。
- 使用能满足需求的最小数值类型（INT 对比 BIGINT，FLOAT 对比 DOUBLE），以减少列宽和内存占用。
- 除非必要，避免在面向 BI 的表中过度使用高精度的 DECIMAL 类型；高精度小数会增加聚合时的 CPU 成本。
- 保持模式简洁稳定。隐式转换（例如在查询时将 STRING 转换为 INT）会禁用优化，并在每次执行时增加不必要的计算。

在 BI 工作负载中，这些选择的影响会迅速累积：一个仪表板页面可能执行数十个查询，每个查询扫描数百万行数据。采用窄列和恰当类型可以减少扫描时间、提高缓存命中率，并让 Photon 以最高效率运行。

经验法则：将模式设计视为一项性能特性。在湖仓中一次性优化好数据类型，当前及未来的所有仪表板都将自动受益。

## 结论

贯穿这十项最佳实践的主题很简单：**避免每次都为仪表板交互支付全价**。让系统每次视图加载时做更少的工作（减少扇出、减少数据扫描），并让系统**所做的工作**可复用（共享数据集、确定性查询、缓存和预计算的聚合结果）。当这些环节协调一致时，性能在高并发下将变得稳定，成本也变得可预测。

具体来说，对于您最常用的仪表板，您应该能够对以下问题回答“是”：

- 用户能否获得**快速的首次渲染**（轻量级着陆视图 + 合理的默认设置）？
- 一次典型的交互是否只触发**少量低成本查询**（参数在扫描前就进行过滤，而非扫描后）？
- 重复的视图加载是否转化为**缓存命中**（确定性图块、跨图块复用、计划性预热）？
- 数据仓库能否在峰值负载下运行而无需**排队或溢出**（峰值排队查询数接近零，查询配置文件未显示溢出）？
- 湖仓是否针对读取进行了优化（健康的文件大小、Liquid Clustering、干净的数据类型以及预计算的热点聚合）？

选择一个实际使用中的仪表板，进行快速基准测试（首次渲染时间、交互延迟、峰值排队查询数、溢出情况、缓存命中率），应用几项最高效的改进措施，然后重新测量。持续这样做，您就能在数据和用户增长的过程中，从“有时快”转变为**始终可靠地快**的 AI/BI 体验。

## 参考资料与延伸阅读

- SQL 仓库大小调整、扩展、排队和监控，Serverless IWM 与 Pro/Classic 自动扩展。https://docs.databricks.com/aws/en/compute/sql-warehouse/warehouse-behavior
- 创建/配置仓库，并发集群数量指南。https://docs.databricks.com/aws/en/compute/sql-warehouse/create
- Serverless 的优势及推荐原因。https://docs.databricks.com/aws/en/compute/sql-warehouse/
- 仓库类型和性能特性（Photon、Predictive IO、IWM，Serverless 启动时间 2–6 秒）。https://docs.databricks.com/aws/en/compute/sql-warehouse/warehouse-types
- 结果缓存（每集群缓存和 Serverless 远程结果缓存）。https://docs.databricks.com/aws/en/lakehouse-architecture/performance-efficiency/best-practiceshttps://learn.microsoft.com/en-us/azure/databricks/sql/user/queries/query-caching
- AI/BI 仪表板：页面/画布/数据模型和组件。https://docs.databricks.com/aws/en/dashboards
- 参数与字段过滤器，基于查询的参数。https://docs.databricks.com/aws/en/dashboards/parameters
- 将仪表板数据集导出到物化视图以加速繁重工作负载。https://docs.databricks.com/aws/en/ai-bi/release-notes/2025
- 审计日志中的仪表板查询执行记录（验证加载时运行的内容）。https://docs.databricks.com/aws/en/admin/account-settings/audit-logs

## 下一步是什么？

---

> 本文由AI自动翻译，原文链接：[The Top 10 Best Practices for AI/BI Dashboards Performance Optimization (Part 2)](https://www.databricks.com/blog/top-10-best-practices-aibi-dashboards-performance-optimization-part-2)
> 
> 翻译时间：2026-02-05 04:18
