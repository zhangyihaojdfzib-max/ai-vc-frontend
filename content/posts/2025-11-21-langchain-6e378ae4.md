---
title: 智能体如何利用文件系统优化上下文工程
title_original: How agents can use filesystems for context engineering
date: '2025-11-21'
source: LangChain Blog
source_url: https://blog.langchain.com/how-agents-can-use-filesystems-for-context-engineering/
author: LangChain Accounts
summary: 本文探讨了文件系统在智能体开发中的关键作用。作者指出，智能体失败常因上下文管理不当，如信息缺失、检索过量或不足。文件系统可作为统一接口，帮助智能体灵活存储、检索和更新海量上下文，从而解决Token过多、需大量上下文、寻找小众信息及持续学习等常见挑战。通过将中间结果卸载至文件系统，智能体能更高效地管理上下文，提升性能并降低成本。
categories:
- AI基础设施
tags:
- 智能体
- 上下文工程
- 文件系统
- LLM优化
- AI开发
draft: false
translated_at: '2026-01-06T01:11:41.908Z'
---

作者：Nick Huang

深度智能体的一个关键特性是它们能够访问一套文件系统工具。这些智能体可以利用这些工具在其文件系统中读取、写入、编辑、列出和搜索文件。

在本文中，我们将探讨为何我们认为文件系统对智能体至关重要。为了理解文件系统如何提供帮助，我们首先需要思考当前智能体在哪些方面存在不足。它们的失败通常源于两个原因：(a) 模型本身不够好，或 (b) 它们无法获取正确的上下文。上下文工程是一门“精巧的艺术与科学，旨在为下一步操作，将恰好合适的信息填入上下文窗口”。理解上下文工程——以及它可能如何失败——对于构建可靠的智能体至关重要。

**关于上下文工程的一个视角**

看待现代智能体工程师工作的一种方式是通过上下文工程的视角。智能体通常可以访问大量上下文（所有支持文档、所有代码文件等）。为了回答一个传入的问题，智能体需要一些重要的上下文（其中包含回答问题所需的信息）。在尝试回答该问题的过程中，智能体会检索一部分上下文（并将其拉入其上下文窗口）。

从这个视角来看，智能体的上下文工程可能在许多方面“失败”：
- 如果智能体所需的上下文不在总上下文中，智能体就无法成功。例如：一个客户支持智能体需要访问某个特定的文档页面来回答问题，但该页面尚未被索引。
- 如果智能体检索到的上下文没有包含其所需的上下文，那么智能体将无法正确回答。例如：一个客户支持智能体需要访问某个特定的文档页面来回答问题，该页面存在且已被索引，但智能体未能检索到它。
- 如果智能体检索到的上下文远大于其所需的上下文，那么智能体就是在浪费资源（时间、Token 或两者兼有）。例如：一个客户支持智能体只需要一个特定的页面，而智能体却检索了100个页面。

我们作为智能体工程师的工作，就是让红色区域（检索到的上下文）尽可能贴近绿色区域（所需上下文），即确保智能体检索到的上下文是所需信息的最小超集。

**在试图隔离合适上下文时出现的一些具体挑战**

- **Token 过多（检索到的上下文 >> 必要上下文）**
    像网络搜索这样的工具可能会返回大量 Token。几次网络搜索就能迅速在对话历史中积累数万个 Token。最终你可能会遇到烦人的“400 Bad Request”错误，但在此之前，你的 LLM 账单就会飙升，性能也会下降。
- **需要大量上下文（必要上下文 > 支持的上下文窗口）**
    有时，智能体确实需要大量信息才能回答问题。这些信息通常无法通过一次搜索查询全部返回，这就是为什么许多人倾向于“智能体搜索”的概念——让智能体反复调用搜索工具。这样做的问题是，上下文量会迅速增长到无法全部放入其上下文窗口的程度。
- **寻找小众信息（检索到的上下文 ≠ 必要上下文）**
    为了处理输入，智能体可能需要参考隐藏在成百上千个文件中的小众信息。智能体如何可靠地找到这些信息？如果找不到，那么检索到的上下文将不是回答问题所需的信息。语义搜索是否有替代方案（或补充方案）？
- **随时间学习（总上下文 ≠ 必要上下文）**
    有时，智能体可能根本无法访问回答问题所需的必要上下文（无论是在其工具中还是指令中）。最终用户在与智能体交互时，可能会经常（隐式或显式地）提供关于该上下文可能是什么的线索。智能体是否有办法将其添加到其上下文中，以供未来迭代使用？

这些都是常见的障碍，我们大多数人都曾遇到过这些问题的不同变体！

**文件系统如何能让智能体变得更好？**

简单来说：文件系统提供了一个单一的接口，智能体可以通过它灵活地存储、检索和更新无限量的上下文。

让我们看看这如何帮助解决上面列出的每种情况。

**Token 过多（检索到的上下文 >> 必要上下文）**
智能体可以将所有工具调用结果和笔记写入文件系统，而不是使用对话历史来保存它们，然后在必要时有选择地查找相关信息。Manus 是首批公开讨论这种方法的人之一——下图来自他们的博客文章。

以网络搜索工具的第一个例子为例。我运行一次网络搜索，从工具中返回了 10k Token 的原始内容。这些内容中的大部分可能并非总是必需的。如果我把它放在消息历史中，这 10k Token 将在整个对话过程中一直存在，推高我的 Anthropic 账单。但是，如果我将这个庞大的工具结果卸载到文件系统，智能体就可以智能地使用 grep 搜索某些关键词，然后只将必要的上下文读入我的对话。

在这个例子中，智能体有效地将文件系统用作大型上下文的草稿纸。

**需要大量上下文（必要上下文 < 支持的上下文窗口）**
有时智能体需要大量上下文来回答问题。文件系统提供了一个很好的抽象，让 LLM 能够根据需要动态存储和拉入更多信息。这方面的例子包括：
- 对于需要长远规划的回答，智能体需要制定计划并遵循它。通过将该计划写入文件系统，智能体可以在以后将这些信息拉回上下文窗口，以提醒自己应该做什么（例如，“通过复述来操纵注意力”）。
- 为了梳理所有这些上下文，智能体可能会启动子智能体。当这些子智能体工作和学习时，它们可以将知识写入文件系统，而不是仅仅将所学内容回复给主智能体（例如，尽量减少“传话游戏”的失真）。
- 一些智能体需要大量关于如何做事的指令。与其将所有指令都塞进系统提示词（并膨胀上下文），不如将它们存储为文件，让智能体根据需要动态读取它们（例如 Anthropic 技能）。

**寻找小众信息（检索到的上下文 ≠ 必要上下文）**
在 LLM 浪潮早期，语义搜索是最流行的上下文检索方法之一。它在某些用例中可能有效，但根据文档类型（例如技术 API 参考、代码文件），由于文本中缺乏语义信息，语义搜索的效果可能非常差。

文件系统提供了一种替代方案，允许智能体使用 `ls`、`glob` 和 `grep` 等工具智能地搜索上下文。如果你最近使用过 Claude Code，你就会知道它严重依赖 `glob` 和 `grep` 搜索来找到所需的正确上下文。这项技术成功有几个关键原因：
- 当今的模型经过专门训练，能够理解遍历文件系统。
- 信息通常已经按逻辑（目录）结构组织好了。
- `glob` 和 `grep` 允许智能体不仅隔离特定文件，还能隔离特定行和特定字符。
- `read_file` 工具允许智能体指定从文件中读取哪些行。

由于这些原因，在某些情况下，使用文件系统（以及通过使用文件系统获得的搜索能力）可以产生更好的结果。

请注意，语义搜索仍然有用！并且可以与文件系统搜索结合使用。Cursor 最近写了一篇博客，强调了将两者结合使用的好处。

**随时间学习（总上下文 ≠ 必要上下文）**
智能体出错的一个重要原因是它们缺少相关的上下文。改进智能体的一个绝佳方法通常是确保它们能够访问正确的上下文。

有时，这看起来像是添加更多数据源或更新系统提示词。
更新系统提示词的一种常见做法是：
- 查看一个智能体缺乏适当指令的示例
- 从领域专家处获取相关指令
- 用这些指令更新提示词

很多时候，最终用户实际上就是最好的领域专家。通过与智能体的对话，他们可能（隐式或显式地）提供关于正确相关指令的重要线索。因此，考虑到这一点——是否有办法自动化上述第三步（用这些指令更新提示词）？

我们认为，智能体的指令（或技能）与其可能想要使用的任何其他上下文并无不同。文件系统可以作为智能体存储和更新自身指令的场所！

在用户给出反馈后，智能体可以立即写入自己的文件，并记住一条重要信息。这对于快速、一次性的信息非常有用，特别是那些可能针对用户定制的信息，如他们的姓名、电子邮件或其他偏好。

这个问题尚未完全解决，仍是一个新兴模式，但这是一种令人兴奋的新方式，让LLM（大语言模型）能够随着时间的推移发展自己的技能集和指令，确保在未来的迭代中能够访问必要的上下文。

**了解深度智能体如何利用其文件系统**

我们有一个名为 Deep Agents（Python, TypeScript）的开源仓库，可以让你快速构建一个能够访问文件系统的智能体。许多使用文件系统的上下文工程技巧都已内置其中！几乎可以肯定，未来会出现更多模式——试试 Deep Agents，并告诉我们你的想法！

---

> 本文由AI自动翻译，原文链接：[How agents can use filesystems for context engineering](https://blog.langchain.com/how-agents-can-use-filesystems-for-context-engineering/)
> 
> 翻译时间：2026-01-06 01:11
