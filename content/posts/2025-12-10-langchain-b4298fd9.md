---
title: 利用LangSmith调试深度智能体：Polly助手与CLI工具
title_original: Debugging Deep Agents with LangSmith
date: '2025-12-10'
source: LangChain
source_url: https://blog.langchain.com/debugging-deep-agents-with-langsmith/
author: LangChain Accounts
summary: 本文探讨了调试深度智能体与简单LLM应用的区别，深度智能体具有提示词长、追踪记录复杂、多轮交互等特点，使得传统调试方法难以应对。文章重点介绍了LangSmith平台的两大调试工具：AI助手Polly能够通过自然语言对话分析追踪记录和会话线程，帮助定位问题并优化提示词；命令行工具langsmith-fetch则为编码智能体提供了直接访问LangSmith追踪数据的能力，方便在开发环境中进行深度调试与分析。
categories:
- 开发者工具
tags:
- LangSmith
- AI调试
- 智能体开发
- LLM工程
- 开发者工具
draft: false
translated_at: '2026-01-04T23:54:32.460Z'
---

调试是发现并修复错误的过程。这是软件工程中的关键步骤，在Agent（智能体）工程中则更为关键。LangSmith的核心能力之一就是提供调试LLM（大语言模型）应用的工具。

如今，我们正加倍努力，为正在开发的新一波“深度Agent”解决这个问题。

在本博客中，我们将：
- 解释为何调试深度Agent与调试简单的LLM应用不同
- 介绍Polly（一个用于Agent工程的AI助手），以帮助在LangSmith中调试深度Agent
- 发布langsmith-fetch，一个为Claude Code或DeepAgents CLI等编码Agent配备调试能力的命令行工具

**深度Agent与简单LLM应用有何不同**

与简单的LLM调用或简短工作流不同，深度Agent会运行数分钟，跨越数十甚至数百个步骤，并且通常涉及与用户的多次来回交互。

因此，一次深度Agent执行所产生的追踪记录可能包含海量信息，远超人类能够轻松扫描或理解的范围。当出现问题时，可能很难判断是哪个决策、提示词指令或工具调用导致了您所看到的行为。

这正是使用LangSmith进行追踪——并利用AI分析这些追踪记录——变得重要的地方。那么，具体是什么让深度Agent更复杂呢？

- **更长的提示词**：深度Agent的提示词通常长达数百甚至数千行——通常包含一个通用角色设定、调用工具的指令、重要指导原则以及少量示例。当行为表现不佳时，很难知道是提示词的哪一部分出了问题。
- **更长的追踪记录**：深度Agent可以运行数十甚至数百个步骤（需要数分钟才能完成）。面对如此庞大的追踪记录，人类需要解析的内容实在太多，难以找到有意义的片段。
- **多轮交互**：深度Agent默认支持人在回路的交互工作流。一次有意义的深度Agent对话示例通常涉及多次来回交互。为了理解Agent的行为并查看其完整轨迹，您需要审视多次交互。

**追踪捕获相关信息**

为了调试Agent，您需要能够洞察其内部正在发生什么。这就是追踪的作用。

我们使用“追踪”这个总称来描述将Agent执行数据记录到LangSmith的过程。数据格式包括运行、追踪记录和会话线程。

- **运行**：您的Agent执行的一个步骤。例如包括LLM模型调用和工具调用。运行以树形结构嵌套。
- **追踪记录**：您的Agent的一次执行。一条追踪记录由一棵运行树组成。
- **会话线程**：追踪记录的集合。一个会话线程是用户与应用程序之间的完整对话。

追踪的设置非常简单——您可以按照[此指南](https://docs.smith.langchain.com/tracing)在几分钟内完成设置。

一旦您的应用数据进入LangSmith，您就可以利用AI来分析完整的Agent轨迹，以了解发生了什么，然后建议对提示词进行更新。主要有两种方式可以实现这一点。

**Polly —— 用于Agent工程的AI助手**

Polly是一项新的应用内功能，允许您通过与一个Agent聊天来分析您的会话线程和追踪数据。请观看我们的[视频概述](https://www.youtube.com/watch?v=YOUR_VIDEO_ID)。

以下是几种与Polly聊天的方式！

**在追踪记录视图中**
您可以使用Polly来调试、分析和理解追踪记录中发生的事情。无需手动扫描数十或数百个步骤，您可以向Polly提问，例如：
- “Agent有没有做什么可以更高效的事情？”
- “Agent有没有犯任何错误？”
这对于深度Agent尤其有帮助，因为它们往往有更长的追踪记录，而故障模式可能分布在许多步骤中。

**在会话线程视图中**
这与单个追踪记录类似，但在这里，Polly可以访问整个会话线程的信息。会话线程跨越多次对话轮次，并且通常也可能跨越数小时或数天。一个人很难掌握所有这些上下文。

**在提示词游乐场中**
深度Agent最重要的部分之一是系统提示词。Polly经过调优，成为了一名出色的提示词工程师！只需用自然语言描述您想要的行为，Polly就会相应地更新您的提示词。Polly还可以帮助您定义结构化输出或在模型调用上模拟工具。

**LangSmith Fetch CLI —— 让您的编码Agent成为专家级Agent工程师的工具**

如果您更喜欢在IDE或编码Agent（例如DeepAgents、Claude Code等）中工作，我们提供了一个CLI工具`langsmith-fetch`，可以轻松连接到LangSmith的追踪记录或会话线程。无论您是在调试Agent、分析对话流，还是从生产追踪记录中构建数据集，这个CLI都能为您提供对LangSmith追踪记录和会话线程的快速、灵活的访问。

它弥合了LangSmith UI与您本地工作流之间的差距，让您可以在确切知道需要什么时通过ID获取追踪记录或会话线程，或者在需要抓取刚刚发生的事情时通过时间获取。该工具支持多种输出格式（人类可读的面板、美观的JSON或紧凑的原始JSON），可适应您的用例——无论您是在终端检查数据、通过管道传输到`jq`，还是将结果提供给LLM进行分析。

它支持两个关键工作流。首先是“我刚运行了某个东西”的工作流，用于抓取最近的会话线程：您执行您的Agent，然后立即运行`langsmith-fetch threads ./my_data`来抓取项目中最新的追踪记录，而无需在UI中寻找ID。添加时间过滤器如`--last-n-minutes 30`来缩小搜索范围，或使用`--project-uuid`来定位特定项目。

```bash
# 刚运行完您的Agent？立即抓取最新的追踪记录
langsmith-fetch traces --project-uuid <your-uuid> --format json
# 或者抓取最后5条追踪记录
langsmith-fetch traces --project-uuid <your-uuid> --limit 5
```

其次是批量导出工作流：当您需要用于评估或分析的数据集时，像`langsmith-fetch threads ./my-data --limit 50`这样的命令会获取多个会话线程并将每个保存为单独的JSON文件，非常适合批处理或构建测试集。

```bash
# 或者从特定项目抓取最后5条追踪记录
```

当然，您也可以提供所需的会话线程或追踪记录ID。输出格式可根据您的需求调整：`--format pretty`用于通过Rich面板在终端查看，`--format json`用于可读的结构化数据，或`--format raw`用于通过管道传输到其他工具。

**LangSmith让调试和改进您的深度Agent变得简单**

深度Agent功能强大，但与简单的LLM工作流相比，运行时间更长且更复杂。为了理解和改进它们，您需要能够洞察您的深度Agent实际在做什么。

借助LangSmith，您可以追踪您的深度Agent并了解正在发生的情况——然后，与Polly聊天以分析您深度Agent的行为，并利用AI帮助您改进提示词。如果您更愿意使用Claude Code或其他编码Agent进行分析，您可以使用LangSmith Fetch为您的编码Agent配备所有必要的调试工具。

只需几分钟即可设置追踪，今天就尝试在LangSmith上与Polly聊天，以调试和改进您的深度Agent吧！

> 本文由AI自动翻译，原文链接：[Debugging Deep Agents with LangSmith](https://blog.langchain.com/debugging-deep-agents-with-langsmith/)
> 
> 翻译时间：2026-01-04 23:54
