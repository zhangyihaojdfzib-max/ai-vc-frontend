---
title: 从数据到对话：构建高性能Genie空间的最佳实践指南
title_original: 'From Data to Dialogue: A Best Practices Guide for Building High-Performing
  Genie Spaces'
date: '2026-02-05'
source: Databricks Blog
source_url: https://www.databricks.com/blog/data-dialogue-best-practices-guide-building-high-performing-genie-spaces
author: ''
summary: 本文介绍了如何通过系统化方法构建高质量的Databricks AI/BI Genie空间，以实现准确、可靠的自助式数据分析。指南强调三个核心步骤：首先，建立坚实、经过整理的数据基础，包括反规范化、预计算指标和创建指标视图以确保一致性。其次，通过定义关键问题基准和期望输出来确立成功标准，实现可衡量的改进。最后，通过丰富元数据、定义表间关系和编码SQL模式，向Genie传授组织特有的业务逻辑、词汇和规则，从而弥合自然语言查询与内部数据上下文之间的差距。
categories:
- AI产品
tags:
- 自助式分析
- 数据治理
- 大语言模型应用
- Databricks
- 最佳实践
draft: false
translated_at: '2026-02-06T04:19:56.764920'
---

在大多数组织中，人们越来越期望任何人都能用简单的英语向数据提问，并立即获得准确的答案。大语言模型并非专为此目的而设计；它们不理解内部缩写、自定义指标或业务实体之间的关联。缺乏这些上下文，即使是简单的问题也可能产生误导性的结果。

实施自助式分析最佳实践改变了组织查询数据的方式。Databricks AI/BI Genie 通过将语言模型与 Databricks 平台上的受治理数据及显式配置相结合，来弥合这一差距。Genie Space 是您编码组织逻辑、词汇和规则的地方，以便自然语言问题能解析为正确的查询。

构建一个可靠的 Genie Space 不仅仅是让 AI 指向数据库。它需要在数据建模、元数据和持续验证方面进行精心的准备。本指南提供了一个实用的、分步的方法，以可扩展的方式完成这项工作。

## 步骤 1：构建坚实的数据基础

Genie Space 的质量在很大程度上取决于底层数据的质量。当数据已经过整理且保持一致时，Genie 的工作会变得更简单、更快速、更准确。目标是提供人类分析师无需额外清理即可信任的、经过整理的数据。

- **反规范化和预连接**：首先在合理的地方对数据模型进行反规范化。预连接表可以降低生成查询的复杂性，并减少错误连接或聚合的风险。
- **预计算常用字段**：您应该预计算常用字段，例如财会期间或标准化状态标志，这样这些值的计算方式就没有歧义。
- **过滤无关数据**：如果某些行或列永远不应被查询，请在数据工程过程中将其移除。不要依赖指令或提示词来弥补糟糕的建模选择。当规则普遍适用时，应在数据本身中强制执行。

指标视图在确保跨团队定义一致性方面起着关键作用。它们允许您在一个地方编码共享的业务逻辑，例如收入或活跃用户的计算。Genie 会自动继承这些定义，这保证了每个查询都依赖于相同的、经过批准的逻辑。这消除了歧义，确保了单一事实来源。

## 步骤 2：通过基准测试定义期望

在配置元数据或 SQL 示例之前，您需要定义成功的标准。一个 Genie Space 不仅应该回答问题，而且应该正确、一致地并以预期的格式回答问题。基准测试使之可衡量。

- **盘点关键问题**：与领域专家合作，收集具有代表性的问题样本。这些应包括简单的查找和更复杂的分析查询。对于每个问题，定义"真实情况"响应作为您的成功标准。这使您能够验证 Genie 不仅正确计算数字，而且隐含地尊重您的格式标准。例如，在验证商户的总批准收入时，基准测试应确保结果被正确分组，而不仅仅是总和准确。
- **指定期望的输出**：对于每个问题，定义期望的输出。答案是否需要特定格式？数值是否应以特定方式聚合？指定期望的格式可确保查询得到公平评估，并使 Genie 学习您组织的呈现标准。
- **建立初始分数**：尽早运行基准测试并预期失败。初始失败是有用的，因为它们精确地指出了 Genie 缺乏上下文的地方。当您完善元数据和逻辑时，应重新运行这些基准测试，以跟踪改进情况，并在数据或配置发生变化时发现回归。

通过使用基准测试工具，您可以通过自动化流程重新运行一组常见查询。这提供了一个一致且可重复的系统，用于评估 Genie Space 在每个阶段的状态，使您能够衡量进展并快速发现回归。

## 步骤 3：向 Genie 传授您组织的逻辑

有了坚实的数据基础，您现在必须向 Genie 传授您组织的具体上下文和规则。这涉及三个不同的配置层：丰富元数据、定义关系和编码 SQL 模式。

1.  **丰富元数据和词汇**
    Genie 从 Unity Catalog 中提取基本的模式信息，但您需要添加"人性化"的上下文。
    *   **表描述**：将其视为"使命宣言"。简要说明表包含的数据以及它回答的具体业务问题。
    *   **列描述**：澄清模糊的字段。如果像 `created_at` 或 `status` 这样的列名含义模糊，请添加描述以确切说明它代表什么（例如，"订单创建的时间戳，UTC 时间"）。
    *   **同义词**：弥合业务术语和技术列名之间的差距。使用同义词将缩写（例如，"ARR"）或内部术语直接映射到相关列。
    *   **值字典**：让 Genie 了解您的实际数据。为分类列启用"示例值"或"值字典"，以便 Genie 可以执行精确匹配（例如，将"Australia"映射到"AUS"），而无需猜测命名约定。

2.  **定义关系**
    Genie 尊重 Unity Catalog 中定义的主键和外键，但您必须在"连接"选项卡中手动配置任何缺失的链接。
    *   **定义基数**：明确说明关系是一对一、一对多还是多对多至关重要。这可以防止 Genie 生成导致行数激增或意外重复计算指标的查询。

3.  **使用 SQL 编码逻辑**
    元数据告诉 Genie 您的数据*是什么*，而提供的 SQL 则教它*如何*查询数据。
    *   **示例查询**：为您最常见或最复杂的问题添加"黄金标准"查询。在这里，您可以演示如何处理复杂逻辑——棘手的计算、特定的过滤器或重复使用的多步聚合——这些是仅靠元数据无法解释的。您还应引入参数，以教导 Genie 如何动态处理变量输入。使用指南允许您明确告诉 Genie*何时*应用特定查询。这消除了相似指标的歧义，并确保 Genie 为正确的场景选择正确的模板。除了逻辑之外，Genie 将示例查询视为样式模板，学习您偏好的格式和编码约定。
    *   **SQL 表达式**：为*过滤器、维度或度量*定义可重用的代码片段。这些充当查询的模块化构建块。至关重要的是，您必须提供关于*何时*使用它们的说明（例如，"每当用户询问'活跃账户'时应用此过滤器"），确保 Genie 正确使用该工具，而不是仅仅猜测。
    *   **可信函数（UDF）**：对于必须完全按原样重用、底层公式无变化的逻辑（例如，标准化的税款计算），使用用户定义函数。这些是严格的函数，Genie 只需传入必要的参数。由于逻辑是锁定的，当 Genie 执行这些函数时，它会在结果上显示一个"可信"徽章，向用户表明他们可以对该答案有信心。

- **表描述**：将这些视为“使命宣言”。简要说明表包含的数据以及它回答的具体业务问题。
- **列描述**：澄清含义模糊的字段。如果像 `created_at` 或 `status` 这样的列名含义模糊，请添加描述以明确其具体含义（例如，“订单创建的时间戳，UTC 时间”）。
- **同义词**：弥合业务术语与技术列名之间的差距。使用同义词将缩写（例如，“ARR”）或内部术语直接映射到相关列。
- **值字典**：让 Genie 了解您的实际数据。为分类列启用“示例值”或“值字典”，以便 Genie 可以执行精确匹配（例如，将“Australia”映射到“AUS”），而无需猜测命名约定。

- **定义基数**：明确说明关系是一对一、一对多还是多对多至关重要。这可以防止 Genie 生成导致行数激增或意外重复计算指标的查询。

- **示例查询**：为您最常见或最复杂的问题添加“黄金标准”查询。这是您展示如何处理复杂逻辑的地方——棘手的计算、特定的过滤器或可重复使用的多步骤聚合——这些是仅靠元数据无法解释的。您还应加入参数，以教导 Genie 如何动态处理变量输入。使用指南允许您明确告诉 Genie *何时*应用特定查询。这可以消除类似指标的歧义，并确保 Genie 为正确的场景选择正确的模板。除了逻辑之外，Genie 将示例查询视为样式模板，学习您偏好的格式和编码约定。
- **SQL 表达式**：专门为*过滤器、维度或度量*定义可重用的代码片段。这些充当查询的模块化构建块。至关重要的是，您必须提供关于*何时*使用它们的说明（例如，“每当用户询问‘活跃账户’时应用此过滤器”），确保 Genie 正确使用该工具，而不是仅仅猜测。
- **可信函数（UDF）**：对于必须完全按原样重用、底层公式无变化的逻辑（例如，标准化的税款计算），使用用户定义函数。这些是严格的函数，Genie 只需传入必要的参数。由于逻辑是锁定的，当 Genie 执行这些函数时，它会在结果上显示“可信”徽章，向用户表明他们可以对该答案有信心。

## 第 4 步：应用通用指令

通用指令提供高层级的上下文，但应谨慎使用。它们不如元数据或 SQL 示例精确，绝不应被用来弥补其他地方的配置缺失。

在添加通用指令之前，请检查问题是否可以通过表描述、字段元数据、连接、示例值或示例查询来解决。仅当没有特定工具适用时，才使用通用指令。

有效的指令用通俗易懂的语言描述业务叙述。它们解释关键实体、生命周期和关系，而不规定具体的 SQL 行为。避免强制选择表、硬编码过滤器或指定输出格式的指令。

使用下面的决策矩阵来诊断常见问题。在添加通用指令之前，请确认您已使用主要配置工具解决了该问题：

本节是您以广泛、概念性的术语与 Genie 沟通的机会。

### 好的通用指令提供叙述

最有效的通用指令为整个组织上下文提供高层级的、人类可读的叙述。可以将其视为为 Genie Space 撰写执行摘要或任务简报。在这里，您需要用通俗易懂的英语解释数据的目的，定义关键实体，并描述它们如何相互关联。

这种上下文应引导 Genie 走向正确的行为模式，而不规定具体的 SQL 命令。它填补了在使用所有更具体的工具后仍然存在的概念空白。

以下是一个为返现和交易数据集设定背景的高层级指令的对比示例：

### 不好的通用指令

无效的指令试图完成更具体工具的工作。它们通常过于僵化，确切地告诉 Genie 如何编写查询，这可能会使其困惑或与从其他配置区域学到的上下文相冲突。避免以下指令：

- **规定使用哪些表或列。** 这是*表/字段描述*和*同义词*的工作。
    - **不要这样做：** “当用户询问销售情况时，使用 transactions 表和 revenue 列。”
    - **应该这样做：** 确保 transactions 表的描述说明它用于销售分析，并且 revenue 列具有相关的同义词。
- **指定格式、别名或要返回的字段。** 这是*示例 SQL 查询*的工作。
    - **不要这样做：** “当显示收入时，将列重命名为‘总收入’并将其格式化为货币。”
    - **应该这样做：** 提供一个正确计算并格式化收入输出的示例查询。
- **硬编码特定值。** 这种逻辑属于数据层或特定的*示例查询*。
    - **不要这样做：** “始终过滤国家为‘AUS’的交易。”
    - **应该这样做：** 在正确的地方处理这个问题。如果这是一个通用规则，请在 Gold Layer 数据中将其过滤掉。如果这是一个常见请求，则添加一个示例查询，展示如何过滤澳大利亚的交易。

## 第 5 步：通过持续反馈保持质量

启动 Genie Space 并不是项目的结束；它是一个活的、不断发展的分析工具的开始。最成功的 Genie Space 是那些与所服务的用户合作，积极监控、维护和改进的 Space。这最后一步将您的 Genie Space 从静态配置转变为适应组织不断变化需求的动态资产。

### 让您的主题专家成为合作伙伴

改进 Genie Space 的最佳情报来源是您的专家用户。授权一小部分 SME 作为倡导者，并为他们提供直接访问权限。鼓励他们使用内置的反馈工具，将回答标记为“好”或“坏”。

这创建了一个强大的、持续的反馈循环。当 SME 与 Genie 合作完善问题并得出正确答案时，这种互动就是一个宝贵的学习机会。捕获他们最终的“好”查询和原始问题，并将其添加到您的示例查询中。这种由实际使用驱动的迭代改进过程，是随着时间的推移提高您 Space 准确性和相关性的最有效方法。

### 使用监控选项卡了解用户行为

监控选项卡是您直接了解用户如何与您的数据互动的窗口。定期查看此仪表板可以提供关于用户行为的宝贵见解，并帮助您识别需要改进的领域。寻找：

- **常见问题：** 最常见的查询是什么？这有助于您了解用户最看重什么。
- **难点：** 是否有 Genie 持续生成不正确或不一致查询的主题？
- **意外使用：** 人们是否在询问您未预料到的问题？

这些数据提供了一个清晰、基于证据的指南，指明了应集中精力的方向——无论是添加新的元数据、优化连接、创建更具针对性的示例查询，还是调整通用指令以更好地支持用户需求。

### 使用基准测试套件验证变更

随着您不断改进和数据演进，您的基准测试套件将成为质量保证和回归测试的主要工具。对Genie Space的任何重大变更（例如添加新的数据源）都应立即跟进一次基准测试运行。

这是验证变更带来积极还是消极影响的最快、最可靠方法。如果发现性能下降，基准测试结果将准确指出哪些查询出现了倒退，从而使您能够精确定位新模糊性的来源并快速解决。这种严谨的方法确保了您的Genie Space在成长过程中，其质量和可靠性始终保持在高水平。

## 从配置到协作

构建一个高性能的Genie Space是持续优化的成果，而非一次性配置。不要试图一次性映射整个数据资产。相反，应选择一个单一、高价值的用例（例如特定的销售仪表板或运营报告），并应用此方法。

首先，精心设计一个干净的数据切片，然后立即建立您的“黄金”基准问题。利用初始基准测试中的失败案例来指导您配置元数据和SQL逻辑。通过专注于这个迭代循环——测试、配置、验证——您将构建出一个用户信任的系统。这种严谨的方法能立即交付自助服务能力。

要在您的工作区中开始使用Genie：
https://docs.databricks.com/aws/en/genie/set-up
https://learn.microsoft.com/en-gb/azure/databricks/genie/set-up
https://docs.databricks.com/gcp/en/genie/set-up

## 后续步骤？

---

> 本文由AI自动翻译，原文链接：[From Data to Dialogue: A Best Practices Guide for Building High-Performing Genie Spaces](https://www.databricks.com/blog/data-dialogue-best-practices-guide-building-high-performing-genie-spaces)
> 
> 翻译时间：2026-02-06 04:19
