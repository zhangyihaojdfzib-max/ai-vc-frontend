---
title: Vercel Sandbox推出基于SNI的出口防火墙，增强代码沙盒网络隔离
title_original: Advanced egress firewall filtering for Vercel Sandbox - Vercel
date: '2026-02-11'
source: Vercel Blog
source_url: https://vercel.com/changelog/advanced-egress-firewall-filtering-for-vercel-sandbox
author: ''
summary: Vercel为其Sandbox功能引入了先进的出口网络防火墙策略，允许开发者通过服务器名称指示（SNI）过滤和CIDR块来控制沙盒可访问的外部主机。该功能在TLS握手阶段检查目标主机名，默认拒绝所有未经授权的连接，有效防止不受信任或AI生成代码的数据泄露或非预期API调用。策略支持动态更新，无需重启进程，既可在创建时限制特定域名（支持通配符），也可在运行时灵活调整访问权限，为运行不可信代码提供了更精细的网络隔离层。
categories:
- AI基础设施
tags:
- Vercel
- 网络安全
- 代码沙盒
- 网络隔离
- TLS
draft: false
translated_at: '2026-02-12T04:23:04.987475'
---

Vercel Sandbox 现在可以通过服务器名称指示（SNI）过滤和CIDR块来强制执行出口网络策略，让您可以控制沙盒能够访问哪些主机。出站TLS连接在握手阶段会根据您的策略进行匹配，任何未经授权的目标都会在数据传输前被拒绝。

默认情况下，沙盒拥有不受限制的互联网访问权限。当运行不受信任或AI生成的代码时，您可以将网络锁定为仅允许您的工作负载实际需要的服务。一个被入侵或产生幻觉的代码片段将无法泄露数据或进行非预期的API调用，任何不在您允许列表中的域名的流量都会被阻止。

### 超越基于IP的规则，实现基于主机的控制

现代互联网运行在主机名而非IP地址之上，少数IP地址服务于成千上万个域名。传统的基于IP的防火墙规则无法精确区分它们。

基于主机的出口控制通常需要HTTP代理，但这会破坏像Redis和Postgres这样的非HTTP协议。相反，我们构建了一个SNI窥探防火墙，它检查TLS握手的初始未加密字节以提取目标主机名。由于如今几乎所有互联网流量都经过TLS加密，这涵盖了所有相关情况。对于遗留或非TLS系统，我们也支持基于IP/CIDR的规则作为备用方案。

### 在创建时限制到特定主机

定义沙盒可以访问哪些域名。其他所有内容默认都被拒绝。通配符支持使得允许CDN背后的服务变得容易：

```
1import { Sandbox } from '@vercel/sandbox';2
3const sandbox = await Sandbox.create({4  networkPolicy: {5    allow: ['ai-gateway.vercel.sh', '*.vercel.com'],6  },7});8
910await sandbox.runCommand('node', ['process-data.js']);
```

### 在初始设置后进行调整

策略可以在运行的沙盒上动态更新，而无需重启进程。从完全互联网访问开始以安装依赖项，在执行不受信任代码前锁定它，在用户批准后重新开放以流式传输结果，然后再次使用`deny-all`进行隔离，全部在一个会话中完成：

```
1import { Sandbox } from '@vercel/sandbox';2
3const sandbox = await Sandbox.create();4
56await sandbox.runCommand('npm', ['install']);7await sandbox.runCommand('aws', ['s3', 'cp', 's3://my-bucket/input-data', './data', '--recursive']);8
910await sandbox.updateNetworkPolicy({11  allow: ['ai-gateway.vercel.sh'],12});13
1415await sandbox.runCommand('node', ['agent.js']);16
1718await sandbox.updateNetworkPolicy({19  allow: ['my-bucket.s3.amazonaws.com'],20});21
22await sandbox.runCommand('aws', ['s3', 'cp', './output/results.json', 's3://my-bucket/output/results.json']);23
2425await sandbox.updateNetworkPolicy('deny-all');
```

阅读文档以了解更多关于网络出口防火墙策略的信息，该功能在所有套餐中均可用。

---

> 本文由AI自动翻译，原文链接：[Advanced egress firewall filtering for Vercel Sandbox - Vercel](https://vercel.com/changelog/advanced-egress-firewall-filtering-for-vercel-sandbox)
> 
> 翻译时间：2026-02-12 04:23
