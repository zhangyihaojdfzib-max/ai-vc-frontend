---
title: 2025年12月5日Cloudflare服务中断事件分析
title_original: Cloudflare outage on December 5, 2025
date: '2025-12-05'
source: Cloudflare Blog
source_url: https://blog.cloudflare.com/5-december-2025-outage/
author: Dane Knecht
summary: 2025年12月5日，Cloudflare因内部配置变更引发全球性服务中断，持续约25分钟，影响约28%的HTTP流量。事件源于为应对React
  Server Components漏洞而增加WAF缓冲区大小的过程中，一项旨在关闭内部测试工具的全局配置更改，触发了旧版代理（FL1）的代码异常，导致部分客户请求返回HTTP
  500错误。Cloudflare强调此次中断非恶意攻击所致，并承诺将发布详细改进措施。
categories:
- AI基础设施
tags:
- Cloudflare
- 服务中断
- WAF
- 基础设施故障
- 运维安全
draft: false
translated_at: '2026-01-05T17:24:37.184Z'
---

注：本文已更新，以澄清内部WAF工具与12月5日事件的关系。
2025年12月5日08:47 UTC（本文所有时间均为UTC），Cloudflare部分网络开始出现严重故障。该事件于09:12得到解决（总计影响约25分钟），所有服务完全恢复。

部分客户受到影响，约占Cloudflare所处理HTTP总流量的28%。如后文所述，需要多个因素同时出现，单个客户才会受到影响。

此问题并非由针对Cloudflare系统的网络攻击或任何类型的恶意活动直接或间接导致。相反，它是由我们对请求体解析逻辑进行更改所触发，该更改旨在检测和缓解本周披露的、影响整个行业的React Server Components漏洞。

我们系统的任何中断都是不可接受的，并且我们知道，继11月18日的事件之后，我们再次让互联网失望。我们将在下周发布详细信息，说明我们正在开展哪些工作以防止此类事件再次发生。

下图显示了事件期间我们网络返回的HTTP 500错误（底部红线），与未受影响的Cloudflare总流量（顶部绿线）的对比。

Cloudflare的Web应用程序防火墙（WAF）为客户提供针对恶意负载的防护，能够检测并阻止它们。为此，Cloudflare的代理会在内存中缓冲HTTP请求体内容以供分析。在今天之前，缓冲区大小设置为128KB。

作为我们保护使用React的客户免受关键漏洞CVE-2025-55182影响的持续工作的一部分，我们开始将缓冲区大小增加到1MB（Next.js应用程序允许的默认限制），以确保尽可能多的客户受到保护。

这第一项更改正在使用我们的渐进式部署系统进行推出。在推出过程中，我们注意到我们的内部WAF测试工具不支持增大的缓冲区大小。由于当时不需要该内部测试工具，且它不影响客户流量，我们进行了第二项更改以将其关闭。

这第二项关闭WAF测试工具的更改是通过我们的全局配置系统实施的。该系统不执行渐进式推出，而是在几秒钟内将更改传播到我们网络中所有服务器，并且在经历了11月18日的中断后，该系统正在接受审查。

不幸的是，在我们FL1版本的代理中，在某些情况下，关闭WAF规则测试工具的第二项更改导致了一个错误状态，致使我们的网络返回HTTP 500错误代码。

一旦更改传播到我们的网络，FL1代理中的代码执行就遇到了规则模块中的一个错误，导致以下Lua异常：
[lua] Failed to run module rulesets callback late_routing: /usr/local/nginx-fl/lua/modules/init.lua:314: attempt to index field 'execute' (a nil value)
从而导致发出HTTP 500错误。

该问题在更改应用后不久即被识别，并于09:12被回滚，此后所有流量均得到正确处理。

由我们较旧的FL1代理提供其网络资产**并且**部署了Cloudflare托管规则集的客户受到了影响。处于此状态下的网站的所有请求均返回HTTP 500错误，少数测试端点（如 /cdn-cgi/trace）除外。

未应用上述配置的客户未受影响。由我们中国网络服务的客户流量也未受影响。

Cloudflare的规则集系统由多组规则组成，这些规则会对进入我们系统的每个请求进行评估。一条规则由一个过滤器（用于选择某些流量）和一个对该流量施加效果的动作组成。典型的动作是"block"、"log"或"skip"。另一种类型的动作是"execute"，用于触发对另一个规则集的评估。

我们的内部日志记录系统使用此功能在向公众提供新规则之前对其进行评估。一个顶级规则集会执行另一个包含测试规则的规则集。我们试图禁用的正是这些测试规则。

作为规则集系统的一部分，我们有一个紧急关闭子系统，旨在允许快速禁用行为异常的规则。该紧急关闭系统从前文提到的全局配置系统接收信息。我们过去曾多次使用此紧急关闭系统来缓解事件，并制定了明确的标准化操作程序，本次事件中也遵循了该程序。

然而，我们以前从未对动作为"execute"的规则应用过紧急关闭。当应用紧急关闭时，代码正确地跳过了对execute动作的评估，并且没有评估它所指向的子规则集。但是，随后在处理评估规则集的整体结果时遇到了错误：
if rule_result.action == "execute" then
rule_result.execute.results = ruleset_results[tonumber(rule_result.execute.results_index)]
end
这段代码预期，如果规则集有action="execute"，则"rule_result.execute"对象将存在。然而，由于该规则已被跳过，rule_result.execute对象不存在，Lua因尝试在nil值中查找值而返回错误。

这是代码中的一个直接错误，已存在多年未被发现。具有强类型系统的语言可以防止此类代码错误。在我们用Rust编写的新FL2代理中，用于替换此段代码的部分没有发生此错误。

关于2025年11月18日事件后正在进行的更改呢？

我们在两周前的2025年11月18日进行了一项不相关的更改，导致了一次类似但持续时间更长的可用性事件。在这两次事件中，旨在帮助缓解客户安全问题的部署都传播到了我们的整个网络，并导致几乎我们所有客户群出现错误。

在那次事件之后，我们已直接与数百名客户沟通，并分享了我们的计划，即进行更改以防止单个更新造成如此广泛的影响。我们相信这些更改本应有助于防止今天事件的影响，但不幸的是，我们尚未完成部署。

我们知道这项工作尚未完成是令人失望的。这仍然是我们整个组织的首要任务。特别是，下面概述的项目应有助于限制此类更改的影响：

增强的推出与版本控制：类似于我们如何通过严格的健康验证缓慢部署软件，用于快速威胁响应和常规配置的数据也需要具备相同的安全性和影响缓解功能。这包括健康验证和快速回滚能力等。

简化的应急操作能力：确保在面对更多类型的故障时，仍能执行关键操作。这适用于内部服务以及所有Cloudflare客户使用的与Cloudflare控制平面交互的所有标准方法。

"故障开放"错误处理：作为弹性工作的一部分，我们正在替换所有关键Cloudflare数据平面组件中错误应用的硬故障逻辑。如果配置文件损坏或超出范围（例如，超出功能上限），系统将记录错误并默认恢复到已知良好状态或在不评分的情况下传递流量，而不是丢弃请求。某些服务可能会让客户在某些场景下选择故障开放或故障关闭。这将包括漂移预防功能，以确保持续强制执行。

在下周末之前，我们将发布所有正在进行中的弹性项目的详细说明，包括上面列出的项目。

在开展此项工作的同时，我们正在锁定网络的所有变更，以确保在重新开始前拥有更完善的缓解和回滚系统。
此类事件及其密集发生的频率，对于我们这样的网络而言是不可接受的。Cloudflare团队全体成员，就此次事件再次给客户乃至整个互联网造成的影响和困扰，深表歉意。

| 时间（UTC） | 状态 | 描述 |
|------------|------|------|
| 08:47 | 事件开始 | 配置变更部署并开始向网络传播 |
| 08:48 | 全面影响 | 变更完成全网传播 |
| 08:50 | 事件确认 | 自动警报触发 |
| 09:11 | 变更回滚 | 配置变更开始回滚并传播 |
| 09:12 | 事件结束 | 回滚完成全网传播，所有流量恢复 |

---

> 本文由AI自动翻译，原文链接：[Cloudflare outage on December 5, 2025](https://blog.cloudflare.com/5-december-2025-outage/)
> 
> 翻译时间：2026-01-05 17:24
