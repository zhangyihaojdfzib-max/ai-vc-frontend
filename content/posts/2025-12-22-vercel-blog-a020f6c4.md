---
title: Vercel：移除80%工具后，AI智能体性能反而提升至100%
title_original: We removed 80% of our agent’s tools - Vercel
date: '2025-12-22'
source: Vercel Blog
source_url: https://vercel.com/blog/we-removed-80-percent-of-our-agents-tools
author: Andrew Qu Chief; Vercel
summary: Vercel团队分享了其数据查询AI工具d0的演进过程。最初他们构建了复杂的工具集和提示工程来约束模型行为，但系统脆弱且维护成本高。后来他们大胆删除了80%的专用工具，仅保留执行bash命令的能力，让Claude模型直接访问文件系统。这种简化架构使智能体能够像人类分析师一样使用grep、cat等Unix工具浏览数据语义层，结果成功率从80%提升至100%，步骤减少，响应更快。文章核心观点是：有时更少的架构约束反而能让大语言模型发挥更好的能力。
categories:
- AI产品
tags:
- AI智能体
- Vercel
- 模型优化
- 工具简化
- 文件系统智能体
draft: false
translated_at: '2026-01-05T16:35:07.400Z'
---

4 分钟阅读
它变得更好了。

我们花了数月时间构建了一个复杂的内部文本转SQL智能体d0，配备了专用工具、大量的提示词工程和精细的上下文管理。它算是能工作……但很脆弱、速度慢，并且需要持续维护。

于是我们尝试了不同的方法。我们删除了大部分内容，将智能体精简到只剩一个工具：执行任意bash命令。我们称之为文件系统智能体。Claude可以直接访问您的文件，并使用 `grep`、`cat` 和 `ls` 来解决问题。

智能体变得更简单，同时也更好了。成功率从80%提升到了100%。步骤更少，Token使用更少，响应更快。这一切都源于我们做得更少。

### 什么是 d0
如果说 v0 是我们用于构建 UI 的 AI，那么 d0 就是我们用于理解数据的 AI。

d0 将自然语言问题转换为针对我们分析基础设施的 SQL 查询，让团队中的任何人都能在不编写代码或等待数据团队的情况下获得答案。

当 d0 运行良好时，它能在全公司范围内实现数据访问的民主化。当它出错时，人们会失去信任，重新回到 Slack 上找分析师。我们需要 d0 快速、准确且可靠。

### 为模型让路
回顾过去，我们当时在解决模型本可以自行处理的问题。我们假设它会在复杂的模式中迷失方向、进行错误的连接或产生关于表名的幻觉。因此我们设置了护栏。我们预先过滤上下文，限制其选项，并将每次交互都包裹在验证逻辑中。我们是在替模型思考：
*   构建了多个专用工具（模式查找、查询验证、错误恢复等）
*   添加了大量的提示词工程来约束推理
*   利用精细的上下文管理来避免模型过载
*   编写手动编码的检索功能以呈现“相关”的模式信息和维度属性

每个边缘情况都意味着另一个补丁，每次模型更新都意味着重新校准我们的约束。我们花在维护脚手架上的时间比改进智能体本身还要多。

```javascript
import { ToolLoopAgent } from 'ai';
import { GetEntityJoins, LoadCatalog, /*...*/ } from '@/lib/tools'

const agent = new ToolLoopAgent({
  model: "anthropic/claude-opus-4.5",
  instructions: "",
  tools: {
    GetEntityJoins,
    LoadCatalog,
    RecallContext,
    LoadEntityDetails,
    SearchCatalog,
    ClarifyIntent,
    SearchSchema,
    GenerateAnalysisPlan,
    FinalizeQueryPlan,
    FinalizeNoData,
    JoinPathFinder,
    SyntaxValidator,
    FinalizeBuild,
    ExecuteSQL,
    FormatResults,
    VisualizeData,
    ExplainResults
  },
});
```

### 一个新想法：如果我们直接……停下来呢？
我们意识到我们是在对抗重力。约束模型的推理。总结它本可以自己阅读的信息。构建工具来保护它免受它本可以处理的复杂性。

所以我们停下来了。我们的假设是：如果我们直接让 Claude 访问原始的 Cube DSL 文件，让它自由发挥会怎样？如果只需要 bash 就够了呢？模型正变得越来越智能，上下文窗口也越来越大，所以也许最好的智能体架构就是几乎没有架构。

### v2：文件系统即智能体
新的技术栈：
*   **模型**：通过 AI SDK 使用的 Claude Opus 4.5
*   **执行**：用于上下文探索的 Vercel Sandbox
*   **路由**：用于请求处理和可观测性的 Vercel Gateway
*   **服务器**：使用 Vercel Slack Bolt 的 Next.js API 路由
*   **数据层**：作为 YAML、Markdown 和 JSON 文件目录的 Cube 语义层

文件系统智能体现在像人类分析师一样浏览我们的语义层。它读取文件、使用 `grep` 搜索模式、构建心智模型，并使用 `grep`、`cat`、`find` 和 `ls` 等标准 Unix 工具编写 SQL。

这之所以有效，是因为语义层本身就是优秀的文档。这些文件包含了维度定义、度量计算和连接关系。我们之前构建工具来总结那些本已清晰可读的内容。Claude 只需要能够直接读取它的权限。

```javascript
import { Sandbox } from "@vercel/sandbox";
import { files } from './semantic-catalog'
import { tool, ToolLoopAgent } from "ai";
import { ExecuteSQL } from "@/lib/tools";
}

const sandbox = await Sandbox.create();
await sandbox.writeFiles(files);

const executeCommandTool(sandbox: Sandbox) {
  return tool({
    /* ... */
    execute: async ({ command }) => {
      const result = await sandbox.exec(command);
      return { /* */ };
    }
  })
}

const agent = new ToolLoopAgent({
  model: "anthropic/claude-opus-4.5",
  instructions: "",
  tools: {
    ExecuteCommand: executeCommandTool(sandbox),
    ExecuteSQL,
  },
})
```

### 速度提升 3.5 倍，Token 减少 37%，成功率 100%
我们针对 5 个代表性查询，对旧架构和新文件系统方法进行了基准测试。

文件系统智能体在每一项比较中都胜出。旧架构的最差情况是查询 2，花费了 724 秒、100 个步骤和 145,463 个 Token，最终还失败了。而文件系统智能体在 141 秒内完成了相同的查询，仅用了 19 个步骤和 67,483 个 Token，并且实际成功了。

质的转变同样重要。智能体能捕捉到我们从未预料到的边缘情况，并以我们可以理解的方式解释其推理过程。

### 经验教训
*   **不要对抗重力**。文件系统是一种极其强大的抽象。`grep` 已有 50 年历史，仍然完全满足我们的需求。我们为 Unix 已经解决的问题构建了自定义工具。
*   **我们约束推理是因为我们不信任模型的推理能力**。对于 Opus 4.5 来说，这种约束变成了一种负担。当我们停止为它做选择时，模型能做出更好的选择。
*   **这之所以有效，是因为我们的语义层已经是良好的文档**。YAML 文件结构良好、命名一致且包含清晰的定义。如果你的数据层是遗留命名约定和未记录连接的烂摊子，给 Claude 原始文件访问权限也救不了你。你只会得到更快的错误查询。
*   **减法带来真正的提升**。最好的智能体可能是工具最少的智能体。每个工具都是你为模型做出的一个选择。有时模型能做出更好的选择。

### 这对智能体构建者意味着什么
诱惑总是去考虑每一种可能性。要抵制它。从最简单的架构开始。模型 + 文件系统 + 目标。只有在你证明有必要时，才增加复杂性。

但仅有简单的架构是不够的。模型需要良好的上下文来工作。投资于文档、清晰的命名和结构良好的数据。这个基础比精巧的工具更重要。

模型的改进速度比你的工具开发速度更快。为你六个月后将会拥有的模型而构建，而不是为你今天拥有的模型而构建。

如果你正在构建智能体，我们很乐意听听你的心得。

### 使用 Vercel 和 Slack 构建智能体
开始使用 Bolt for JavaScript 和 Nitro 模板创建你自己的 Slack 智能体。将其部署在 Vercel 上，几分钟内即可获得一个可投入生产的实时设置。

[部署模板](https://vercel.com/templates/slack/bolt-slack-bot)

---

> 本文由AI自动翻译，原文链接：[We removed 80% of our agent’s tools - Vercel](https://vercel.com/blog/we-removed-80-percent-of-our-agents-tools)
> 
> 翻译时间：2026-01-05 13:29
